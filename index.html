<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Soldiers of Valor - Veteran Resource Command Console</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --hud-green: #31ff7a;
            --hud-green-dark: #1f3324;
            --hud-bg: #09100d;
            --hud-card: #0e1612;
        }

        body {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            background-color: #020617;
            color: #e5e7eb;
        }

        .hud-glow { text-shadow: 0 0 8px rgba(49,255,122,0.5); }
        .hud-border { border: 1px solid rgba(49,255,122,0.25); }
        .hud-border-strong { border: 1px solid rgba(49,255,122,0.5); }

        .nav-shadow { box-shadow: 0 4px 24px rgba(0,0,0,0.6); }
        .hero-bg {
            background: linear-gradient(
                to bottom,
                rgba(9,16,13,0.95),
                rgba(4,7,5,0.99)
            );
            border-bottom: 1px solid rgba(49,255,122,0.25);
        }

        /* Cards */
        .panel {
            background: var(--hud-card);
            border-radius: 0.75rem;
            border: 1px solid rgba(148,163,184,0.25);
            padding: 1.2rem;
            box-shadow: 0 0 16px rgba(0,0,0,0.4);
        }

        .accent-green { color: #22c55e; }
        .accent-orange { color: #f97316; }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(to bottom, var(--hud-green), #0f3d24);
            color: #020617;
            padding: 0.7rem 1.2rem;
            border-radius: 0.6rem;
            font-weight: 800;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            border: 1px solid rgba(49,255,122,0.8);
            transition: 0.15s ease;
        }
        .btn-primary:hover:not(:disabled) {
            filter: brightness(1.15);
            box-shadow: 0 0 18px rgba(49,255,122,0.7);
        }
        .btn-primary:disabled {
            background: #374151;
            color: #9ca3af;
            border-color: rgba(75,85,99,0.8);
            box-shadow: none;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #0c1410;
            border: 1px solid rgba(148,163,184,0.4);
            padding: 0.65rem 1rem;
            border-radius: 0.5rem;
            font-weight: 700;
            color: #e5e7eb;
            text-transform: uppercase;
            letter-spacing: 0.07em;
            transition: 0.15s ease;
        }
        .btn-secondary:hover:not(:disabled) {
            background: rgba(49,255,122,0.15);
            border-color: var(--hud-green);
            box-shadow: 0 0 12px rgba(49,255,122,0.5);
        }
        .btn-secondary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Tab Bar */
        .tab-button {
            flex: 1;
            padding: 0.75rem;
            background: #0b1310;
            border-bottom: 3px solid rgba(49,255,122,0.25);
            font-weight: 700;
            letter-spacing: 0.1em;
            transition: 0.15s ease;
            font-size: 0.74rem;
            text-transform: uppercase;
        }
        .tab-button:hover {
            background: rgba(49,255,122,0.1);
        }
        .tab-active {
            background: rgba(49,255,122,0.18);
            border-color: var(--hud-green);
            box-shadow: 0 0 12px rgba(49,255,122,0.4);
            color: var(--hud-green);
        }
        .tab-inactive {
            opacity: 0.8;
            color: #9ca3af;
        }

        /* Inputs / Textareas */
        input[type="text"],
        textarea {
            background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 1));
            border: 1px solid rgba(34, 197, 94, 0.7);
            color: #bbf7d0;
            padding: 0.7rem 0.8rem;
            border-radius: 0.65rem;
            font-size: 0.85rem;
            outline: none;
            box-shadow: 0 0 0 1px rgba(15, 23, 42, 1);
            transition:
                border-color 0.16s ease,
                box-shadow 0.16s ease,
                background 0.16s ease;
        }
        input[type="text"]::placeholder,
        textarea::placeholder {
            color: rgba(148, 163, 184, 0.7);
        }
        input[type="text"]:focus,
        textarea:focus {
            border-color: #f97316;
            box-shadow:
                0 0 0 1px rgba(15, 23, 42, 1),
                0 0 18px rgba(249, 115, 22, 0.7);
            background: radial-gradient(circle at top left, rgba(22, 163, 74, 0.22), rgba(15, 23, 42, 0.98));
        }

        /* Loading ring */
        .loading-ring {
            border: 4px solid rgba(30, 64, 175, 0.6);
            border-top: 4px solid #22c55e;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            box-shadow: 0 0 18px rgba(34, 197, 94, 0.7);
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal overlay */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.98));
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
            backdrop-filter: blur(10px);
        }

        /* Toast / message box */
        .message-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 60;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .message-box.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-3px);
        }

        /* Resource section tweaks */
        #resource-section h2 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }
        #resource-section h2::before {
            content: "‚óâ";
            font-size: 0.85rem;
            color: #22c55e;
            text-shadow: 0 0 12px rgba(34, 197, 94, 0.8);
        }
        #resource-list li {
            position: relative;
            overflow: hidden;
        }
        #resource-list li::before {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: linear-gradient(
                120deg,
                transparent 0%,
                rgba(34, 197, 94, 0.06) 40%,
                rgba(59, 130, 246, 0.05) 60%,
                transparent 100%
            );
            opacity: 0;
            transition: opacity 0.18s ease-in-out;
        }
        #resource-list li:hover::before {
            opacity: 1;
        }
        #resource-list .accent-orange {
            text-shadow: 0 0 10px rgba(249, 115, 22, 0.9);
        }
        #resource-list a {
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-size: 0.7rem;
        }
        #resource-list a:hover {
            text-shadow: 0 0 9px rgba(34, 197, 94, 0.9);
        }

        /* Resume preview (Style 2 - clean professional) */
        .resume-card {
            background: #f9fafb;
            color: #111827;
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 10px 30px rgba(0,0,0,0.35);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }
        .resume-section-title {
            font-weight: 700;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #4b5563;
            margin-top: 1.25rem;
            margin-bottom: 0.25rem;
        }
        .resume-divider {
            border-top: 1px solid #e5e7eb;
            margin-top: 0.4rem;
            margin-bottom: 0.6rem;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">

    <!-- CRISIS HEADER -->
    <header class="p-4 bg-red-700/30 text-white text-center shadow-md border-b border-red-500">
        <h1 class="text-3xl font-extrabold tracking-widest hud-glow">
            SOLDIERS OF VALOR
        </h1>
        <p class="text-sm opacity-80">OPERATIONAL STATUS: HIGH</p>

        <a href="tel:988"
           class="mt-3 inline-flex items-center space-x-2 bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-md font-bold transition shadow-xl">
           <span>üö® CRISIS LINE: CALL 988</span>
        </a>
    </header>

    <!-- AUTH STATUS -->
    <div id="auth-status" class="bg-green-900/40 text-green-400 p-2 text-xs text-center border-b border-green-700">
        :: INITIALIZING SECURE LINK ::
    </div>

    <!-- NEW STICKY NAVBAR -->
    <nav class="sticky top-0 z-50 bg-[#0f1a14] nav-shadow border-b border-green-900">
        <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3">

            <!-- LOGO -->
            <span class="text-lg font-bold text-[var(--hud-green)] hud-glow tracking-widest">
                COMMAND CONSOLE
            </span>

            <!-- SEARCH -->
            <input id="sov-search"
                   type="text"
                   placeholder="Search benefits, jobs, resources..."
                   onkeydown="if(event.key==='Enter'){performSearch()}"
                   class="hidden md:block px-3 py-2 bg-[#0c140f] text-gray-300 hud-border rounded focus:outline-none w-72" />

            <!-- NAV LINKS -->
            <div class="hidden md:flex space-x-6 text-sm uppercase tracking-widest">
                <button class="hover:text-[var(--hud-green)]" onclick="window.switchTab('goals')">Mission Planner</button>
                <button class="hover:text-[var(--hud-green)]" onclick="window.switchTab('map')">Local Resources</button>
                <button class="hover:text-[var(--hud-green)]" onclick="window.switchTab('employment')">Employment</button>
                <button class="hover:text-[var(--hud-green)]" onclick="window.switchTab('resume')">Resume Forge</button>
                <button class="hover:text-[var(--hud-green)]" onclick="window.switchTab('benefits')">Benefits</button>
                <button class="hover:text-[var(--hud-green)]" onclick="window.switchTab('muster')">The Muster</button>
            </div>
        </div>
    </nav>

    <!-- HERO SECTION -->
    <section class="hero-bg py-16 text-center">
        <h1 class="text-4xl md:text-5xl font-extrabold text-[var(--hud-green)] hud-glow tracking-wide">
            YOUR TACTICAL ADVANTAGE IN CIVILIAN LIFE
        </h1>
        <p class="mt-6 text-gray-300 text-lg max-w-2xl mx-auto">
            Real-time resources, mission-ready planning, employment translation, resume building, and community support ‚Äî
            all inside a unified HUD-style veteran platform.
        </p>

        <div class="mt-8 flex flex-wrap justify-center gap-4">
            <button onclick="window.switchTab('goals')" class="btn-primary">
                Launch Mission Planner
            </button>
            <button onclick="window.switchTab('resume')" class="btn-secondary">
                Forge My Resume
            </button>
            <button onclick="window.switchTab('map')" class="btn-secondary">
                Scan Local Resources
            </button>
        </div>
    </section>

    <!-- TAB BAR -->
    <div class="flex bg-[#0b1310] border-b border-green-800 overflow-x-auto">
        <button id="tab-map" class="tab-button tab-inactive" onclick="window.switchTab('map')">RESOURCE LOCATOR</button>
        <button id="tab-benefits" class="tab-button tab-inactive" onclick="window.switchTab('benefits')">BENEFITS PROTOCOL</button>
        <button id="tab-goals" class="tab-button tab-inactive" onclick="window.switchTab('goals')">MISSION PLANNER</button>
        <button id="tab-muster" class="tab-button tab-inactive" onclick="window.switchTab('muster')">THE MUSTER</button>
        <button id="tab-employment" class="tab-button tab-active" onclick="window.switchTab('employment')">EMPLOYMENT HUB</button>
        <button id="tab-resume" class="tab-button tab-inactive" onclick="window.switchTab('resume')">RESUME FORGE</button>
    </div>

    <!-- MAIN CONTENT -->
    <main class="flex-grow max-w-6xl mx-auto w-full px-4 py-6 space-y-6">

        <!-- TAB 1: RESOURCE MAP CONTENT -->
        <section id="content-map" class="hidden space-y-4">
            <button id="view-history-btn" class="btn-secondary w-full" disabled>
                ACCESS LOG HISTORY (LOADING...)
            </button>

            <div id="location-card" class="panel space-y-3">
                <h2 class="text-xl font-semibold accent-green flex items-center space-x-2">
                    <span>üéØ</span>
                    <span>TARGET: Local Resources</span>
                </h2>
                <div id="location-info" class="text-gray-300">
                    <p>Execute location scan to identify nearby services.</p>
                    <p id="current-location" class="font-medium mt-2 hidden">
                        COORDS: <span id="lat-long" class="accent-orange"></span>
                    </p>
                </div>
                <button id="find-location-btn" class="btn-primary w-full" disabled>
                    EXECUTE LOCATION SCAN
                </button>
                <div id="loading-indicator" class="hidden flex justify-center py-2">
                    <div class="loading-ring"></div>
                </div>
            </div>

            <div id="resource-section" class="resource-list panel space-y-3 hidden">
                <h2 class="text-xl font-semibold accent-green">LOCAL RESOURCE SCAN: LIVE DATA</h2>
                <p class="text-sm text-gray-400">STATUS: synced with secure Firebase node.</p>
                <ul id="resource-list" class="space-y-4"></ul>
            </div>
        </section>

        <!-- TAB 2: BENEFITS NAVIGATOR CONTENT -->
        <section id="content-benefits" class="hidden space-y-6">
            <h2 class="text-2xl font-bold accent-green border-b border-gray-600 pb-2 font-mono">
                BENEFITS PROTOCOL: CLAIMS
            </h2>
            <p class="text-gray-400 text-sm">
                Filing a disability claim is mission-critical. The steps provided are general knowledge and in no way
                constitute legal advice. Every outcome is different...
            </p>

            BENEFITS PROTOCOL: CLAIMS</h2> <p class="text-gray-400 text-sm">Filing a disability claim is mission-critical. The steps provided are general knowledge and in no way constitute legal advice. Every outcome is different and we share our knowledge to help get the best outcome for our veteran brothers and sisters. Feel free to email us if you have anything to add to this sequence.</p> <!-- Step 1 --> <div class="panel p-4 space-y-2 border-l-4 border-green-500"> <div class="flex items-center space-x-2"> <span class="text-xl font-extrabold accent-orange">01</span> <h3 class="font-bold text-lg accent-green">DATA ACQUISITION</h3> </div> <ul class="list-disc ml-5 text-sm text-gray-400 space-y-1"> <li>***The best practice before filing a claim is to seek outside medical attention.*** If it is a PTSD claim, seek mental health providers ahead of time, if it is an injury, seek help from a specialist before filing, this step alone is crucial in establishing your nexus, which is discussed later in these steps.</li> <li>**Service Connection:** Acquire DD-214 and Service Treatment Records (STRs).You can request records from the National Archives online, by mail, or by fax. (If you‚Äôre submitting an application for VA benefits, VA will request your DD214 for you when they receive your application. You don‚Äôt need to do this yourself through the National Archives.) If you already have a copy, you can upload it with your claim. You can request your military service records online using the National Archives‚Äô eVetRecs tool. When you get to eVetRecs, select Make a new request. There is also a link and instructions here (<a href="https://www.va.gov/records/get-military-service-records/" target="_blank" class="accent-orange hover:text-red-500">MILITARY SERVICE RECORDS</a>). You‚Äôll then need to sign in with an identity-verified ID.me account. The National Archives may ask you to take a ‚Äúlive selfie‚Äù photo with your smartphone as an added step to verification. Option 2: Fill out the National Archive‚Äôs request form (to mail or fax) Fill out a Request Pertaining to Military Records (Standard Form 180). You can get the form here (<a href="https://www.va.gov/find-forms/about-form-sf180/" target="_blank" class="accent-orange hover:text-red-500">VA FORM SF180</a>). Mail or fax your completed form to the appropriate address or fax number listed on the last page of the form. To find the right address or fax number for you, you‚Äôll need to use the first chart on that page to find your branch of service, separation date, and type of record. </li> <li>**Medical Evidence:** Secure your Service Treatment Records (STRs): These documents detail any medical issues you experienced during your active duty. They serve as direct evidence of in-service events or injuries that may have contributed to your current condition. VA and Private Medical Records: Include records from both VA facilities and private healthcare providers. These documents help establish a history of treatment and demonstrate the progression and severity of your condition. Independent Medical Opinions (IMOs) and NEXUS Letters: A NEXUS letter from a qualified medical professional is crucial. It should explicitly state whether your condition is "at least as likely as not" related to your military service, providing a clear connection for the VA. Diagnostic Test Results: Include results from X-rays, MRIs, lab tests, and other diagnostic procedures that confirm your diagnosis. This evidence is particularly important for conditions like PTSD, chronic pain, and orthopedic injuries. Lay Evidence (Buddy Statements): Statements from fellow service members, family, or friends who can attest to the onset or worsening of your condition can support your medical evidence, especially if your service records are incomplete.</li> <li>**Nexus:** As stated above, this step is crucial in linking current status to service actions (e.g., doctor's statement). (<a target="_blank" class="accent-orange hover:text-red-500">!!! BE AWARE!!!</a>) Several companies are filing claims for veterans' benefits, often charging fees for services that are legally required to be free. Here are some key points: For-Profit Consultants: Many for-profit companies charge veterans fees for help filing disability claims, operating in a legal loophole where only accredited agents and Veterans Service Organizations (VSOs) can assist with claims. Legislative Actions: States like Maine, New Jersey, and New York have passed laws to crack down on these practices, while Louisiana has allowed companies to charge up to $12,500 for services that should be free. Opposition to Legislation: Advocacy groups, including the Veterans of Foreign Wars, oppose bills that would allow for-profit companies to charge veterans for initial claims assistance, arguing that free help is already available through accredited representatives. Predatory Practices: Some companies exploit veterans' trust by offering misleading services, often resulting in financial strain and limited improvement in claims outcomes. These practices raise significant concerns about the integrity of the veterans' claims process and the exploitation of vulnerable populations.!!! Please look into these with caution if you decide to go this route. Although some say you do not have to pay unless your claim is accepted, many take large portions or all of the backpay you would recieve. </li> </ul> </div>

           <!-- Step 2 --> <div class="panel p-4 space-y-2 border-l-4 border-green-500"> <div class="flex items-center space-x-2"> <span class="text-xl font-extrabold accent-orange">02</span> <h3 class="font-bold text-lg accent-green">SUBMISSION ROUTE</h3> </div> <ul class="list-disc ml-5 text-sm text-gray-400 space-y-1"> <li>**Fast Track:** Utilize the VA digital portal (<a href="https://www.va.gov" target="_blank" class="accent-orange hover:text-red-500">VA.gov</a>). Although this is a "fasttrack", the VA takes time to review all of your information. This is really only a "fast track" in the sense that it is an easy way to submit your application. All claims are different and some may be faster than others. Be patient, but file your Intent To File ASAP. More on this later. </li> <li>**Priority Channel:** Contact a Veterans Service Officer (VSO) for free, expert support. This is a prefered channel. VSO's are there to help and navigate the VA system of forms and filing. One of the issues that can arise though is the speed at which you can be seen. Depending on location and number of VSO's, it can take some time to schedule to meet and go throguh your filing process.</li> <li>(<a target="_blank" class="accent-orange hover:text-red-500">!!!Effective Date Lock!!!</a>): File an Intent to File immediately!!! You can do so here (<a href="https://www.va.gov/supporting-forms-for-claims/intent-to-file-form-21-0966/introduction" target="_blank" class="accent-orange hover:text-red-500">INTENT TO FILE</a>). An intent to file is a formal notification to the VA that a veteran plans to submit a claim for disability compensation, pension, or survivors' benefits. This process allows veterans to gather necessary documentation while protecting the earliest possible effective date for their claim, which can lead to retroactive benefits if the claim is approved. This means if you are getting backpay it will be retroactive to the date of your intent to file. </li> </ul> </div>

            <!-- Step 3 --> <div class="panel p-4 space-y-2 border-l-4 border-green-500"> <div class="flex items-center space-x-2"> <span class="text-xl font-extrabold accent-orange">03</span> <h3 class="font-bold text-lg accent-green">C&P EVALUATION</h3> </div> <ul class="list-disc ml-5 text-sm text-gray-400 space-y-1"> <li>**Compliance:** Attend all mandated Compensation & Pension (C&P) exams. A claim (C&P) exam isn‚Äôt like a normal medical exam. The provider won‚Äôt treat you for any illness or injury, give you referrals to other providers, or prescribe medicine. The purpose of the exam is to gather information that will help the VA make a decision on your claim. During your exam, the provider may do any or all of these things: Perform a basic physical exam. (This may or may not include physical contact) Ask you questions based on the medical records in your claim file. These may include questions from the Disability Benefits Questionnaire (DBQ) for each service-connected condition you‚Äôre claiming. Ask you to get other tests (like X-rays or blood work), at no cost to you. Note: If you have questions about what‚Äôs happening during your exam, you can ask the provider. But they can‚Äôt answer questions about the claims process, tell you the exam results, or make decisions about your claim. </li> <li>**Reporting:** Describe your condition's CURRENT impact on daily function. Make sure to be thorough in your descriptions. If you have trouble sleeping, let them know how many nights in any given week you may have trouble. The more info given, the better the VA can assess and treat when your claim is accepted. </li> </ul> </div> <!-- Step 4 --> <div class="panel p-4 space-y-2 border-l-4 border-green-500"> <div class="flex items-center space-x-2"> <span class="text-xl font-extrabold accent-orange">04</span> <h3 class="font-bold text-lg accent-green">RESOLUTION & APPEAL</h3> </div> <ul class="list-disc ml-5 text-sm text-gray-400 space-y-1"> <li>**Review:** Confirm the rating accuracy upon decision.</li> <li>**Recourse:** If denied, consult VSO immediately to initiate Supplemental, HLR, or Board Appeal.</li> </ul> </div> <p class="text-xs text-gray-500 pt-2">:: DISCLOSURE: THIS IS A GUIDANCE TOOL, NOT OFFICIAL VA DIRECTIVE. CONSULT VSO. ::</p> </div>

            <!-- Step 4 -->
            <div class="panel space-y-2 border-l-4 border-green-500">
                <div class="flex items-center space-x-2">
                    <span class="text-xl font-extrabold accent-orange">04</span>
                    <h3 class="font-bold text-lg accent-green">RESOLUTION &amp; APPEAL</h3>
                </div>
                <ul class="list-disc ml-5 text-sm text-gray-400 space-y-1">
                    <li><strong>Review:</strong> Confirm rating accuracy upon decision.</li>
                    <li><strong>Recourse:</strong> If denied, consult a VSO immediately to initiate an appeal.</li>
                </ul>
            </div>

            <p class="text-xs text-gray-500 pt-2">
                :: DISCLOSURE: THIS IS A GUIDANCE TOOL, NOT OFFICIAL VA DIRECTIVE. CONSULT VSO. ::
            </p>
        </section>

        <!-- TAB 3: MISSION GOAL TRACKER CONTENT -->
        <section id="content-goals" class="hidden space-y-4">
            <h2 class="text-2xl font-bold accent-green border-b border-gray-600 pb-2 font-mono">
                MISSION PLANNER
            </h2>
            <p class="text-gray-400 text-sm">
                Define your objective and track your steps. Progress is logged in your secure private cloud.
            </p>

            <div class="panel space-y-3">
                <h3 class="text-xl font-semibold accent-green border-b border-gray-600 pb-2">
                    INPUT NEW OBJECTIVE
                </h3>
                <input type="text" id="goal-title"
                       placeholder="E.g., Complete my degree, Find a career in tech, Improve fitness"
                       maxlength="80">
                <div id="milestone-inputs" class="space-y-2">
                    <input type="text" data-milestone="1" placeholder="Step 1: Define specific task" class="text-sm">
                    <input type="text" data-milestone="2" placeholder="Step 2: Define specific task" class="text-sm">
                    <input type="text" data-milestone="3" placeholder="Step 3: Define specific task" class="text-sm">
                </div>
                <button id="add-goal-btn" class="btn-primary w-full" disabled>
                    SAVE NEW MISSION
                </button>
            </div>

            <div class="space-y-3">
                <h3 class="text-xl font-semibold accent-green border-b border-gray-600 pb-2">
                    ACTIVE MISSIONS
                </h3>
                <div id="goal-list-container" class="space-y-4">
                    <p id="goals-loading" class="text-center text-gray-500 py-4">
                        Awaiting missions... Initializing link.
                    </p>
                </div>
            </div>
        </section>

        <!-- TAB 4: COMMUNITY MUSTER -->
        <section id="content-muster" class="hidden space-y-4">
            <h2 class="text-2xl font-bold accent-green border-b border-gray-600 pb-2 font-mono">
                THE MUSTER (SECURE CHANNEL)
            </h2>
            <p class="text-gray-400 text-sm">
                Post tactical status updates and community announcements.
            </p>

            <div class="panel space-y-3">
                <textarea id="huddle-post-input"
                          placeholder="Transmit message (Max 200 chars)"
                          rows="2"
                          maxlength="200"></textarea>
                <button id="post-message-btn" class="btn-primary w-full" disabled>
                    TRANSMIT MESSAGE
                </button>
            </div>

            <div id="community-feed" class="space-y-3 max-h-[60vh] overflow-y-auto">
                <p id="muster-loading" class="text-center text-gray-500 py-4">
                    :: CHANNEL STATUS: AWAITING LINK ::
                </p>
            </div>
        </section>

        <!-- TAB 5: EMPLOYMENT HUB -->
        <section id="content-employment" class="space-y-6">
            <h2 class="text-2xl font-bold accent-green border-b border-gray-600 pb-2 font-mono">
                EMPLOYMENT HUB: SKILLS TRANSLATOR
            </h2>
            <p class="text-gray-400 text-sm">
                Translate MOS/Rate/Duty into Civilian Credentials for maximum resume impact.
            </p>

            <div class="panel space-y-4">
                <h3 class="text-xl font-semibold accent-green">
                    MILITARY TO CIVILIAN TRANSLATION
                </h3>

                <input type="text" id="military-term-input"
                       placeholder="INPUT MOS, RATE, OR DUTY (e.g., 68W, EO, PLATOON LEADER)">

                <button id="translate-btn"
                        class="bg-orange-500 text-gray-900 py-3 rounded-md font-bold shadow-md transition-colors duration-200 hover:bg-orange-600 w-full">
                    EXECUTE TRANSLATION
                </button>

                <div id="translation-result" class="hidden border-t border-gray-600 pt-4 space-y-3">
                    <div id="job-title-output" class="text-lg font-bold text-green-400"></div>
                    <div id="skills-output" class="text-gray-300 space-y-1"></div>
                    <p class="text-xs text-gray-500 mt-2">
                        :: CREDENTIALS READY FOR RESUME INTEGRATION ::
                    </p>
                </div>
            </div>

            <div class="space-y-3">
                <h3 class="text-xl font-semibold accent-green border-b border-gray-600 pb-2">
                    TOP EMPLOYMENT ASSETS
                </h3>
                <ul class="space-y-3 text-sm text-gray-300">
                    <li class="p-3 bg-gray-800 rounded-md border-l-4 border-green-500">
                        <a href="https://www.linkedin.com/in/vets"
                           target="_blank"
                           class="font-bold text-green-400 hover:text-green-300">
                            LinkedIn for Veterans:
                        </a> Priority access to job seekers.
                    </li>
                    <li class="p-3 bg-gray-800 rounded-md border-l-4 border-green-500">
                        <a href="https://www.dol.gov/agencies/vets"
                           target="_blank"
                           class="font-bold text-green-400 hover:text-green-300">
                            Dept. of Labor VETS:
                        </a> Career training and workshops.
                    </li>
                </ul>
            </div>
        </section>

        <!-- TAB 6: RESUME FORGE (STYLE 2) -->
        <section id="content-resume" class="hidden space-y-6">
            <h2 class="text-2xl font-bold accent-green border-b border-gray-600 pb-2 font-mono">
                RESUME FORGE: PROFESSIONAL BUILDER
            </h2>
            <p class="text-gray-400 text-sm">
                Build a clean, recruiter-ready resume that translates your service into civilian language.
            </p>

            <div class="grid md:grid-cols-2 gap-6 items-start">
                <!-- Builder Form -->
                <div class="panel space-y-4">
                    <h3 class="text-xl font-semibold accent-green border-b border-gray-600 pb-2">
                        INPUT RESUME DATA
                    </h3>

                    <!-- Contact -->
                    <div class="space-y-2">
                        <h4 class="text-sm font-semibold text-gray-300 uppercase tracking-wide">
                            Contact Information
                        </h4>
                        <input type="text" data-resume-input id="res-name" placeholder="Full Name">
                        <input type="text" data-resume-input id="res-email" placeholder="Email">
                        <input type="text" data-resume-input id="res-phone" placeholder="Phone">
                        <input type="text" data-resume-input id="res-location" placeholder="Location (City, State)">
                    </div>

                    <!-- Headline / Target Role -->
                    <div class="space-y-2">
                        <h4 class="text-sm font-semibold text-gray-300 uppercase tracking-wide">
                            Target Role / Headline
                        </h4>
                        <input type="text" data-resume-input id="res-target-role"
                               placeholder="e.g., Project Manager / Operations Lead">
                    </div>

                    <!-- Summary -->
                    <div class="space-y-2">
                        <h4 class="text-sm font-semibold text-gray-300 uppercase tracking-wide">
                            Professional Summary
                        </h4>
                        <textarea data-resume-input id="res-summary" rows="3"
                                  placeholder="Brief 2‚Äì3 sentence summary highlighting your service, strengths, and career goals."></textarea>
                    </div>

                    <!-- Experience -->
                    <div class="space-y-3">
                        <h4 class="text-sm font-semibold text-gray-300 uppercase tracking-wide">
                            Experience (Up to 3 Roles)
                        </h4>

                        <!-- Experience 1 -->
                        <div class="border border-gray-700 rounded-md p-3 space-y-2">
                            <input type="text" data-resume-input id="exp1-title" placeholder="Job Title (e.g., Squad Leader)">
                            <input type="text" data-resume-input id="exp1-company" placeholder="Organization / Unit">
                            <input type="text" data-resume-input id="exp1-dates" placeholder="Dates (e.g., 2018 ‚Äì 2022)">
                            <textarea data-resume-input id="exp1-bullets" rows="2"
                                      placeholder="Bullets (separate with semicolons ; )"></textarea>
                        </div>

                        <!-- Experience 2 -->
                        <div class="border border-gray-700 rounded-md p-3 space-y-2">
                            <input type="text" data-resume-input id="exp2-title" placeholder="Job Title">
                            <input type="text" data-resume-input id="exp2-company" placeholder="Organization / Company">
                            <input type="text" data-resume-input id="exp2-dates" placeholder="Dates">
                            <textarea data-resume-input id="exp2-bullets" rows="2"
                                      placeholder="Bullets (separate with semicolons ; )"></textarea>
                        </div>

                        <!-- Experience 3 -->
                        <div class="border border-gray-700 rounded-md p-3 space-y-2">
                            <input type="text" data-resume-input id="exp3-title" placeholder="Job Title">
                            <input type="text" data-resume-input id="exp3-company" placeholder="Organization / Company">
                            <input type="text" data-resume-input id="exp3-dates" placeholder="Dates">
                            <textarea data-resume-input id="exp3-bullets" rows="2"
                                      placeholder="Bullets (separate with semicolons ; )"></textarea>
                        </div>
                    </div>

                    <!-- Education -->
                    <div class="space-y-3">
                        <h4 class="text-sm font-semibold text-gray-300 uppercase tracking-wide">
                            Education (Up to 2 Entries)
                        </h4>

                        <div class="border border-gray-700 rounded-md p-3 space-y-2">
                            <input type="text" data-resume-input id="edu1-school" placeholder="School / Institution">
                            <input type="text" data-resume-input id="edu1-degree" placeholder="Degree / Program">
                            <input type="text" data-resume-input id="edu1-year" placeholder="Year (e.g., 2023)">
                        </div>

                        <div class="border border-gray-700 rounded-md p-3 space-y-2">
                            <input type="text" data-resume-input id="edu2-school" placeholder="School / Institution">
                            <input type="text" data-resume-input id="edu2-degree" placeholder="Degree / Program">
                            <input type="text" data-resume-input id="edu2-year" placeholder="Year">
                        </div>
                    </div>

                    <!-- Skills -->
                    <div class="space-y-2">
                        <h4 class="text-sm font-semibold text-gray-300 uppercase tracking-wide">
                            Skills (Comma Separated)
                        </h4>
                        <textarea data-resume-input id="res-skills" rows="2"
                                  placeholder="Leadership, Logistics, Risk Management, Training & Development"></textarea>
                    </div>

                    <div class="flex flex-wrap gap-3 pt-2">
                        <button type="button" class="btn-secondary" id="res-clear-btn">
                            Reset Builder
                        </button>
                        <p class="text-xs text-gray-500">
                            :: Tip: Copy text from the preview panel into Word/Indeed/USAJOBS. ::
                        </p>
                    </div>
                </div>

                <!-- Resume Preview -->
                <div class="resume-card text-left">
                    <div id="resume-preview">

                        <!-- Header -->
                        <div>
                            <h1 id="resume-name" style="font-size:1.6rem; font-weight:700;">YOUR NAME</h1>
                            <div id="resume-contact" style="font-size:0.8rem; color:#4b5563; margin-top:0.15rem;">
                                City, ST ‚Ä¢ email@example.com ‚Ä¢ (555) 555-5555
                            </div>
                            <div id="resume-target-role" style="font-size:0.9rem; font-weight:600; color:#111827; margin-top:0.6rem;">
                                Target Role / Headline
                            </div>
                        </div>

                        <!-- Summary -->
                        <div>
                            <div class="resume-section-title">PROFESSIONAL SUMMARY</div>
                            <div class="resume-divider"></div>
                            <p id="resume-summary" style="font-size:0.85rem; color:#111827;">
                                Motivated veteran with a proven record of leadership, accountability, and mission success. Skilled at
                                translating complex objectives into clear action, building cohesive teams, and delivering results under
                                pressure.
                            </p>
                        </div>

                        <!-- Skills -->
                        <div>
                            <div class="resume-section-title">KEY SKILLS</div>
                            <div class="resume-divider"></div>
                            <ul id="resume-skills-list" style="font-size:0.85rem; color:#111827; display:flex; flex-wrap:wrap; gap:0.35rem;">
                                <li>Leadership</li>
                                <li>Team Coordination</li>
                                <li>Operations Planning</li>
                            </ul>
                        </div>

                        <!-- Experience -->
                        <div>
                            <div class="resume-section-title">EXPERIENCE</div>
                            <div class="resume-divider"></div>
                            <div id="resume-experience" style="font-size:0.85rem; color:#111827;">
                                <!-- Filled by JS -->
                            </div>
                        </div>

                        <!-- Education -->
                        <div>
                            <div class="resume-section-title">EDUCATION</div>
                            <div class="resume-divider"></div>
                            <div id="resume-education" style="font-size:0.85rem; color:#111827;">
                                <!-- Filled by JS -->
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </section>

        <!-- MESSAGE / ALERT CONTAINER -->
        <div id="message-box" class="message-box p-4 hidden">
            <div id="message-content"
                 class="bg-red-700 text-white p-3 rounded-md shadow-xl text-sm font-medium border border-red-500"></div>
        </div>

        <!-- HISTORY MODAL -->
        <div id="history-modal" class="modal-overlay hidden">
            <div class="panel rounded-xl p-6 w-11/12 max-w-md max-h-[80vh] flex flex-col">
                <h3 class="text-2xl font-bold accent-green mb-4 border-b border-gray-600 pb-2">
                    ACCESS LOG: HISTORY (SECURE)
                </h3>
                <div id="history-list" class="flex-grow overflow-y-auto space-y-3 pr-2">
                    <p class="text-center text-gray-500 mt-4">:: LOADING LOGS ::</p>
                </div>
                <button id="close-history-btn" class="mt-4 btn-secondary">
                    CLOSE LOG
                </button>
            </div>
        </div>

    </main>

    <!-- FIREBASE + APP LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import {
            getAuth,
            signInAnonymously,
            signInWithCustomToken,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import {
            getDatabase,
            ref,
            push,
            set,
            update,
            onValue,
            remove
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        let db, auth;
        let userId = null;
        let isAuthReady = false;

        const appId = 'veteran-resource-app';

        const firebaseConfig = {
            apiKey: "AIzaSyDxWnKmEvg-JFxXopujpYiDQ98bee5n46E",
            authDomain: "vetchat-prod.firebaseapp.com",
            projectId: "vetchat-prod",
            storageBucket: "vetchat-prod.appspot.com",
            messagingSenderId: "511042065899",
            appId: "1:511042065899:web:da21e4652341903e5ef5ae",
            measurementId: "G-18R9J9CF33S",
            databaseURL: "https://vetchat-prod-default-rtdb.firebaseio.com"
        };

        const initialAuthToken = null;

        const authStatusEl        = document.getElementById('auth-status');
        const findLocationBtn     = document.getElementById('find-location-btn');
        const addGoalBtn          = document.getElementById('add-goal-btn');
        const postMessageBtn      = document.getElementById('post-message-btn');
        const viewHistoryBtn      = document.getElementById('view-history-btn');
        const historyListEl       = document.getElementById('history-list');
        const goalListContainerEl = document.getElementById('goal-list-container');
        const goalTitleInput      = document.getElementById('goal-title');
        const milestoneInputs     = document.getElementById('milestone-inputs').querySelectorAll('input');
        const goalsLoadingEl      = document.getElementById('goals-loading');
        const huddlePostInput     = document.getElementById('huddle-post-input');
        const communityFeedEl     = document.getElementById('community-feed');
        const musterLoadingEl     = document.getElementById('muster-loading');

        function showMessage(text, isError = false) {
            const msgBox = document.getElementById('message-box');
            const msgContent = document.getElementById('message-content');

            if (isError) {
                msgContent.className = 'bg-red-700 text-white p-3 rounded-md shadow-xl text-sm font-medium border border-red-500';
            } else {
                msgContent.className = 'bg-green-700 text-white p-3 rounded-md shadow-xl text-sm font-medium border border-green-500';
            }

            msgContent.textContent = text;
            msgBox.classList.add('show');
            msgBox.classList.remove('hidden');

            setTimeout(() => {
                msgBox.classList.remove('show');
                setTimeout(() => msgBox.classList.add('hidden'), 300);
            }, 3000);
        }

        const getPrivateRef = (path) => {
            if (!db || !userId) return null;
            return ref(db, `artifacts/${appId}/users/${userId}/${path}`);
        };

        function getPublicRef(path) {
            return ref(db, `artifacts/${appId}/_public/data/${path}`);
        }

        function renderResourceList(items) {
            const section = document.getElementById("resource-section");
            const listEl = document.getElementById("resource-list");

            listEl.innerHTML = "";

            if (!items || items.length === 0) {
                section.classList.add("hidden");
                return;
            }

            section.classList.remove("hidden");

            items.forEach(item => {
                const html = `
                    <li class="border-b border-gray-600 pb-3">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl accent-orange">‚öë</span>
                            <div class="flex-grow">
                                <p class="font-bold text-lg">${item.name || 'Resource'}</p>
                                <p class="text-sm text-gray-400">${item.facility || ''}</p>
                            </div>
                        </div>
                        ${item.link ? `<a href="${item.link}" target="_blank" class="accent-green font-semibold text-sm hover:text-green-300">ROUTE</a>` : ''}
                        <p class="text-xs text-gray-500 mt-1">${item.description || ''}</p>
                    </li>
                `;
                listEl.insertAdjacentHTML("beforeend", html);
            });
        }

        function startResourceListener() {
            const resourcesRef = getPublicRef("resource_locations");
            onValue(resourcesRef, (snapshot) => {
                const data = snapshot.val() || {};
                const items = Object.keys(data).map(id => ({
                    id,
                    ...data[id]
                }));
                renderResourceList(items);
            });
        }

        try {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db   = getDatabase(app);

            async function authenticate() {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Firebase Authentication Error:", error);
                    showMessage("AUTH ERROR: Could not establish secure link.", true);
                }
            }

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    userId = user.uid;
                    isAuthReady = true;
                    authStatusEl.innerHTML = `:: SECURE LINK ESTABLISHED - UNIT ID: <span class="accent-orange">${userId.substring(0, 8)}...</span> ::`;

                    findLocationBtn.disabled = false;
                    addGoalBtn.disabled      = false;
                    postMessageBtn.disabled  = false;
                    viewHistoryBtn.disabled  = false;

                    startHistoryListener();
                    startGoalListener();
                    startMusterListener();
                    startResourceListener();
                } else {
                    userId = null;
                    isAuthReady = false;
                    authStatusEl.innerHTML = ":: LINK FAILURE. Attempting reconnection. ::";

                    findLocationBtn.disabled = true;
                    addGoalBtn.disabled      = true;
                    postMessageBtn.disabled  = true;
                    viewHistoryBtn.disabled  = true;
                }
            });

            authenticate();
        } catch (error) {
            console.error("Firebase Init Error:", error);
            authStatusEl.innerHTML = ":: ERROR: CONFIG FAILURE. Firebase services unavailable. ::";
        }

        async function logSearch(lat, lon) {
            if (!isAuthReady || !userId) return;
            const historyRef = getPrivateRef('search_history');
            if (!historyRef) return;

            const entryRef = push(historyRef);
            try {
                await set(entryRef, {
                    timestamp: Date.now(),
                    latitude: lat,
                    longitude: lon,
                    mock_resources_found: 4,
                    location_description: "Local Area Scan"
                });
            } catch (e) {
                console.error("Error logging search:", e);
                showMessage("Database error: Could not log search history.", true);
            }
        }

        function startHistoryListener() {
            const historyRef = getPrivateRef('search_history');
            if (!historyRef) return;

            onValue(historyRef, (snapshot) => {
                const data = snapshot.val() || {};
                const items = Object.keys(data).map(id => ({ id, ...data[id] }));
                items.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                updateHistoryUI(items);
            }, (error) => {
                console.error("History Listener Error:", error);
                historyListEl.innerHTML = '<p class="text-center text-red-400 mt-4">:: HISTORY LOG ERROR ::</p>';
            });
        }

        function updateHistoryUI(historyItems) {
            viewHistoryBtn.textContent = `ACCESS LOG HISTORY (${historyItems.length} RECORDS)`;
            historyListEl.innerHTML = '';

            if (historyItems.length === 0) {
                historyListEl.innerHTML = '<p class="text-center text-gray-500 mt-4">:: NO LOGS FOUND IN DATABASE ::</p>';
                return;
            }

            historyItems.forEach((item, index) => {
                const date = item.timestamp ? new Date(item.timestamp).toLocaleString() : 'Pending Sync';
                const lat  = typeof item.latitude  === 'number' ? item.latitude.toFixed(4)  : 'N/A';
                const lon  = typeof item.longitude === 'number' ? item.longitude.toFixed(4) : 'N/A';

                const itemHtml = `
                    <div class="bg-gray-700/50 p-3 rounded-md border border-gray-600">
                        <p class="accent-green font-semibold">LOG ENTRY #${historyItems.length - index}</p>
                        <p class="text-sm text-gray-400">TIMESTAMP: ${date}</p>
                        <p class="text-sm text-gray-400 mt-1">
                            <span class="font-medium">COORDS:</span> ${lat}, ${lon}
                        </p>
                        <p class="text-xs accent-orange mt-1">
                            Found ${item.mock_resources_found || 0} assets in the ${item.location_description || 'Area'} area.
                        </p>
                    </div>
                `;
                historyListEl.insertAdjacentHTML('beforeend', itemHtml);
            });
        }

        addGoalBtn.addEventListener('click', async () => {
            if (!isAuthReady || !userId) return showMessage("Authentication required to save mission.", true);

            const title = goalTitleInput.value.trim();
            const steps = Array.from(milestoneInputs)
                .map(input => input.value.trim())
                .filter(text => text.length > 0)
                .map(text => ({ text, completed: false }));

            if (title.length < 5) return showMessage("Input requires more detail for objective title.", true);
            if (steps.length === 0) return showMessage("Input requires at least one defined step.", true);

            addGoalBtn.disabled = true;
            const goalsRef = getPrivateRef('goals');
            const newGoalRef = push(goalsRef);

            try {
                await set(newGoalRef, {
                    title,
                    steps,
                    created_at: Date.now()
                });
                showMessage(`New mission "${title}" saved!`, false);
                goalTitleInput.value = '';
                milestoneInputs.forEach(input => input.value = '');
            } catch (e) {
                console.error("Error adding goal:", e);
                showMessage("Database error: Could not save mission.", true);
            } finally {
                addGoalBtn.disabled = false;
            }
        });

        function startGoalListener() {
            const goalsRef = getPrivateRef('goals');
            if (!goalsRef) return;

            onValue(goalsRef, (snapshot) => {
                const data = snapshot.val() || {};
                const goals = Object.keys(data).map(id => ({ id, ...data[id] }));

                goals.sort((a, b) => {
                    const aComplete = (a.steps || []).every(s => s.completed);
                    const bComplete = (b.steps || []).every(s => s.completed);
                    if (aComplete === bComplete) return 0;
                    return aComplete ? 1 : -1;
                });

                renderGoals(goals);
            }, (error) => {
                console.error("Goals Listener Error:", error);
                goalsLoadingEl.textContent = ':: MISSION DATA ERROR ::';
            });
        }

        function renderGoals(goals) {
            goalListContainerEl.innerHTML = '';

            if (goals.length === 0) {
                goalsLoadingEl.textContent = ':: NO ACTIVE MISSIONS. SET OBJECTIVES ABOVE ::';
                goalListContainerEl.appendChild(goalsLoadingEl);
                return;
            } else if (goalsLoadingEl.parentElement) {
                goalsLoadingEl.remove();
            }

            goals.forEach(goal => {
                const steps = goal.steps || [];
                const totalSteps = steps.length;
                const completedSteps = steps.filter(s => s.completed).length;
                const progress = totalSteps > 0 ? Math.round((completedSteps / totalSteps) * 100) : 0;

                let stepsHtml = '';
                steps.forEach((step, index) => {
                    const checked = step.completed ? 'checked' : '';
                    const lineThrough = step.completed ? 'line-through text-gray-500' : 'text-gray-300';
                    stepsHtml += `
                        <label class="flex items-center space-x-2 py-1 cursor-pointer">
                            <input type="checkbox"
                                   data-goal-id="${goal.id}"
                                   data-step-index="${index}"
                                   ${checked}
                                   class="form-checkbox h-4 w-4 text-green-400 rounded bg-gray-700/50"
                                   onchange="window.toggleStep(this)">
                            <span class="text-sm ${lineThrough}">${step.text}</span>
                        </label>
                    `;
                });

                const goalHtml = `
                    <div class="panel border-t-4 ${progress === 100 ? 'border-orange-500' : 'border-green-500'}">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="text-lg font-extrabold accent-orange">${goal.title}</h4>
                            <span class="text-xs text-gray-400">${progress}% COMPLETE</span>
                        </div>
                        <div class="w-full bg-gray-600 rounded-full h-2.5 mb-4">
                            <div class="bg-green-500 h-2.5 rounded-full" style="width: ${progress}%"></div>
                        </div>
                        <div class="space-y-1">
                            ${stepsHtml}
                        </div>
                        <button onclick="window.deleteGoal('${goal.id}')"
                                class="text-red-500 hover:text-red-300 text-xs mt-3 float-right">
                            ABORT MISSION
                        </button>
                    </div>
                `;
                goalListContainerEl.insertAdjacentHTML('beforeend', goalHtml);
            });
        }

        window.toggleStep = async function(checkbox) {
            if (!isAuthReady || !userId) return;

            const goalId = checkbox.dataset.goalId;
            const stepIndex = checkbox.dataset.stepIndex;
            const isCompleted = checkbox.checked;

            const stepRef = getPrivateRef(`goals/${goalId}/steps/${stepIndex}`);
            try {
                await update(stepRef, { completed: isCompleted });
                showMessage(isCompleted ? "Step marked COMPLETE!" : "Step reverted.", false);
            } catch (e) {
                console.error("Error toggling step:", e);
                showMessage("Database error: Could not update mission step.", true);
                checkbox.checked = !isCompleted;
            }
        };

        window.deleteGoal = async function(goalId) {
            if (!isAuthReady || !userId) return;

            const goalRef = getPrivateRef(`goals/${goalId}`);
            try {
                await remove(goalRef);
                showMessage("Mission aborted successfully.", false);
            } catch (e) {
                console.error("Error deleting goal:", e);
                showMessage("Database error: Could not abort mission.", true);
            }
        };

        postMessageBtn.addEventListener('click', async () => {
            if (!isAuthReady || !userId) return showMessage("Authentication required to transmit message.", true);

            const message = huddlePostInput.value.trim();
            if (message.length === 0) return showMessage("Message cannot be empty.", true);

            postMessageBtn.disabled = true;
            const musterRef = getPublicRef('community_messages');
            const newPostRef = push(musterRef);

            try {
                await set(newPostRef, {
                    message,
                    user_id: userId,
                    timestamp: Date.now()
                });
                huddlePostInput.value = '';
                showMessage("Message transmitted to The Muster.", false);
            } catch (e) {
                console.error("Error posting message:", e);
                showMessage("Database error: Could not transmit message.", true);
            } finally {
                postMessageBtn.disabled = false;
            }
        });

        function startMusterListener() {
            const musterRef = getPublicRef('community_messages');
            if (!musterRef) return;

            onValue(musterRef, (snapshot) => {
                const data = snapshot.val() || {};
                const posts = Object.keys(data).map(id => ({ id, ...data[id] }));
                posts.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                renderMusterFeed(posts);
            }, (error) => {
                console.error("Muster Listener Error:", error);
                musterLoadingEl.textContent = ':: CHANNEL STATUS: DATA LINK ERROR ::';
            });
        }

        function renderMusterFeed(posts) {
            communityFeedEl.innerHTML = '';

            if (posts.length === 0) {
                communityFeedEl.innerHTML = '<p class="text-center text-gray-500 py-4">:: FIRST TRANSMISSION AWAITED ::</p>';
                return;
            }

            posts.forEach(post => {
                const isMine = post.user_id === userId;
                const time = post.timestamp ? new Date(post.timestamp).toLocaleTimeString() : 'N/A';

                const postHtml = `
                    <div class="panel ${isMine ? 'bg-green-900/40 border-green-600' : 'bg-gray-700/50 border-gray-600'}">
                        <p class="text-xs font-bold ${isMine ? 'accent-green' : 'accent-orange'}">
                            ${isMine ? 'YOU' : (post.user_id || '').substring(0, 8) + '...'}
                            <span class="text-gray-500 font-normal">@ ${time}</span>
                        </p>
                        <p class="text-sm text-gray-300 mt-1 whitespace-pre-wrap">${post.message}</p>
                    </div>
                `;
                communityFeedEl.insertAdjacentHTML('beforeend', postHtml);
            });
        }

        const mockTranslations = {
            "68W": { title: "EMERGENCY MEDICAL TECHNICIAN / CLINICAL ASSISTANT", skills: ["Advanced Trauma Care", "Patient Triage", "Field Operations Management", "Basic Life Support (BLS)"] },
            "EO": { title: "HEAVY EQUIPMENT OPERATOR / SITE MANAGER", skills: ["Earth Moving Equipment Operation", "Site Preparation & Grading", "Safety Compliance (OSHA)", "Maintenance & Repair Scheduling"] },
            "PLATOON LEADER": { title: "PROJECT MANAGER / OPERATIONS DIRECTOR", skills: ["Strategic Planning (Agile/Waterfall)", "Team Leadership (20+ Personnel)", "Logistics & Supply Chain Management", "Budget Allocation & Oversight"] },
            "LOGISTICS": { title: "SUPPLY CHAIN ANALYST / INVENTORY CONTROL MANAGER", skills: ["Warehouse Operations", "Inventory Management Systems (WMS)", "Risk Mitigation", "Global Distribution Planning"] },
            "HR": { title: "HUMAN RESOURCES SPECIALIST / PERSONNEL ADMINISTRATOR", skills: ["Talent Acquisition", "Employee Relations", "Confidential Record Keeping", "Benefits Administration"] },
            "INFANTRY": { title: "SECURITY SPECIALIST / TEAM LEADER", skills: ["Risk Assessment", "Conflict Resolution", "Executive Protection", "Cross-Functional Team Collaboration"] },
        };

        document.getElementById('translate-btn').addEventListener('click', () => {
            const translateBtn      = document.getElementById('translate-btn');
            const militaryTermInput = document.getElementById('military-term-input');
            const translationResult = document.getElementById('translation-result');
            const jobTitleOutput    = document.getElementById('job-title-output');
            const skillsOutput      = document.getElementById('skills-output');

            const term = militaryTermInput.value.trim().toUpperCase();

            if (term.length < 2) {
                return showMessage("INPUT MOS OR DUTY CODE (MIN 2 CHARS).", true);
            }

            translateBtn.disabled = true;
            translationResult.classList.add('hidden');
            jobTitleOutput.textContent = '';
            skillsOutput.innerHTML = '';

            setTimeout(() => {
                const translation =
                    mockTranslations[term] ||
                    mockTranslations[Object.keys(mockTranslations).find(key => term.includes(key))];

                if (translation) {
                    jobTitleOutput.textContent = `CIVILIAN ROLE: ${translation.title}`;
                    let skillsList = '';
                    translation.skills.forEach(skill => {
                        skillsList += `<p class="text-sm font-semibold flex items-center accent-green">
                            <span class="accent-orange mr-2 text-xl">‚Ä¢</span>${skill}</p>`;
                    });
                    skillsOutput.innerHTML =
                        `<h4 class="font-bold mt-2 accent-green">CORE SKILLS TRANSLATED:</h4><div class="space-y-1">${skillsList}</div>`;
                    translationResult.classList.remove('hidden');
                    showMessage(`Translation executed successfully for "${term}".`, false);
                } else {
                    jobTitleOutput.textContent = ":: DIRECT TRANSLATION FAILED ::";
                    skillsOutput.innerHTML =
                        "<p class='text-sm text-gray-500'>Try a common rating (e.g., HR, EO) or a general duty area (e.g., INFANTRY, LOGISTICS).</p>";
                    translationResult.classList.remove('hidden');
                    showMessage("TRANSLATION FAIL. RE-ENTER TERM.", true);
                }
                translateBtn.disabled = false;
            }, 500);
        });

        document.getElementById('view-history-btn').addEventListener('click', () => {
            document.getElementById('history-modal').classList.remove('hidden');
        });

        document.getElementById('close-history-btn').addEventListener('click', () => {
            document.getElementById('history-modal').classList.add('hidden');
        });

        window.switchTab = function(tabName) {
            const tabs = ['map', 'benefits', 'goals', 'muster', 'employment', 'resume'];
            tabs.forEach(tab => {
                const content = document.getElementById(`content-${tab}`);
                const button  = document.getElementById(`tab-${tab}`);

                if (!content || !button) return;

                if (tab === tabName) {
                    content.classList.remove('hidden');
                    button.classList.add('tab-active');
                    button.classList.remove('tab-inactive');
                } else {
                    content.classList.add('hidden');
                    button.classList.remove('tab-active');
                    button.classList.add('tab-inactive');
                }
            });

            const section = document.getElementById(`content-${tabName}`);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            window.switchTab('employment');
            initResumeBuilder();
        });

        document.getElementById('find-location-btn').addEventListener('click', () => {
            if (!isAuthReady) return showMessage("Authentication required to log location scan.", true);

            const button          = document.getElementById('find-location-btn');
            const loading         = document.getElementById('loading-indicator');
            const locationInfo    = document.getElementById('current-location');
            const resourceSection = document.getElementById('resource-section');
            const latLongDisplay  = document.getElementById('lat-long');

            button.disabled = true;
            button.textContent = 'EXECUTING SCAN...';
            loading.classList.remove('hidden');

            if (!navigator.geolocation) {
                showMessage("GEOLOCATION HARDWARE FAILURE.", true);
                button.disabled = false;
                button.textContent = 'EXECUTE LOCATION SCAN';
                loading.classList.add('hidden');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    button.textContent = 'SCAN COMPLETE';
                    loading.classList.add('hidden');

                    latLongDisplay.textContent = `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
                    locationInfo.classList.remove('hidden');
                    resourceSection.classList.remove('hidden');

                    logSearch(lat, lon);

                    setTimeout(() => {
                        button.disabled = false;
                        button.textContent = 'RE-EXECUTE SCAN';
                    }, 1000);
                },
                (error) => {
                    let errorMessage = "ERROR: UNABLE TO RETRIEVE COORDS.";
                    if (error.code === error.PERMISSION_DENIED) {
                        errorMessage = "ERROR: GEOLOCATION DENIED. ENABLE DEVICE SERVICES.";
                    } else if (error.code === error.POSITION_UNAVAILABLE) {
                        errorMessage = "ERROR: LOCATION DATA UNAVAILABLE.";
                    } else if (error.code === error.TIMEOUT) {
                        errorMessage = "ERROR: LOCATION REQUEST TIMEOUT.";
                    }

                    showMessage(errorMessage, true);

                    button.disabled = false;
                    button.textContent = 'EXECUTE LOCATION SCAN';
                    loading.classList.add('hidden');
                    locationInfo.classList.add('hidden');
                    resourceSection.classList.add('hidden');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                }
            );
        });

        // üîé SEARCH FUNCTION ‚Äì hooks into tabs + sections (includes resume now)
        window.performSearch = function() {
            const input = document.getElementById('sov-search');
            if (!input) return;

            const q = input.value.toLowerCase().trim();
            if (!q) return;

            const sections = [
                { id: "content-map",        tab: "map" },
                { id: "content-benefits",   tab: "benefits" },
                { id: "content-goals",      tab: "goals" },
                { id: "content-muster",     tab: "muster" },
                { id: "content-employment", tab: "employment" },
                { id: "content-resume",     tab: "resume" }
            ];

            let found = false;

            sections.forEach(sec => {
                const el = document.getElementById(sec.id);
                if (!el) return;

                if (!found && el.innerText.toLowerCase().includes(q)) {
                    found = true;
                    window.switchTab(sec.tab);

                    el.scrollIntoView({ behavior: "smooth", block: "start" });
                    el.style.transition = "background 0.6s ease";
                    el.style.background = "rgba(56, 189, 248, 0.18)";

                    setTimeout(() => {
                        el.style.background = "";
                    }, 1400);
                }
            });

            if (!found) {
                showMessage("No results found for: " + q, true);
            }
        };

        // ===================== RESUME BUILDER LOGIC =====================
        function initResumeBuilder() {
            const inputs = document.querySelectorAll('[data-resume-input]');
            const clearBtn = document.getElementById('res-clear-btn');

            function updatePreview() {
                const name      = (document.getElementById('res-name').value || '').trim();
                const email     = (document.getElementById('res-email').value || '').trim();
                const phone     = (document.getElementById('res-phone').value || '').trim();
                const location  = (document.getElementById('res-location').value || '').trim();
                const target    = (document.getElementById('res-target-role').value || '').trim();
                const summary   = (document.getElementById('res-summary').value || '').trim();
                const skillsStr = (document.getElementById('res-skills').value || '').trim();

                // Header
                document.getElementById('resume-name').textContent =
                    name || 'YOUR NAME';

                let contactLine = [];
                if (location) contactLine.push(location);
                if (email) contactLine.push(email);
                if (phone) contactLine.push(phone);
                document.getElementById('resume-contact').textContent =
                    contactLine.join(' ‚Ä¢ ') || 'City, ST ‚Ä¢ email@example.com ‚Ä¢ (555) 555-5555';

                document.getElementById('resume-target-role').textContent =
                    target || 'Target Role / Headline';

                // Summary
                document.getElementById('resume-summary').textContent =
                    summary ||
                    'Motivated veteran with a proven record of leadership, accountability, and mission success. Skilled at translating complex objectives into clear action, building cohesive teams, and delivering results under pressure.';

                // Skills
                const skillsListEl = document.getElementById('resume-skills-list');
                skillsListEl.innerHTML = '';
                let skills = [];
                if (skillsStr) {
                    skills = skillsStr.split(',').map(s => s.trim()).filter(Boolean);
                }
                if (skills.length === 0) {
                    skills = ['Leadership', 'Team Coordination', 'Operations Planning'];
                }
                skills.forEach(skill => {
                    const li = document.createElement('li');
                    li.textContent = skill;
                    skillsListEl.appendChild(li);
                });

                // Experience
                const expContainer = document.getElementById('resume-experience');
                expContainer.innerHTML = '';

                const exps = [1,2,3].map(i => ({
                    title:  document.getElementById(`exp${i}-title`).value.trim(),
                    company:document.getElementById(`exp${i}-company`).value.trim(),
                    dates:  document.getElementById(`exp${i}-dates`).value.trim(),
                    bullets:(document.getElementById(`exp${i}-bullets`).value || '')
                                .split(';').map(b => b.trim()).filter(Boolean)
                })).filter(e => e.title || e.company || e.dates || e.bullets.length);

                if (exps.length === 0) {
                    expContainer.innerHTML = `
                        <div style="margin-bottom:0.6rem;">
                            <div style="font-weight:600;">Squad Leader</div>
                            <div style="font-size:0.8rem; color:#4b5563;">U.S. Army ‚Äî 2018 ‚Äì 2022</div>
                            <ul style="margin-top:0.25rem; padding-left:1rem; list-style:disc;">
                                <li>Led and mentored a team in high-stress environments to achieve mission objectives.</li>
                                <li>Coordinated training, logistics, and equipment readiness for multiple operations.</li>
                            </ul>
                        </div>
                    `;
                } else {
                    exps.forEach(exp => {
                        const wrapper = document.createElement('div');
                        wrapper.style.marginBottom = '0.6rem';

                        const titleLine = document.createElement('div');
                        titleLine.style.fontWeight = '600';
                        titleLine.textContent = exp.title || 'Role';

                        const metaLine = document.createElement('div');
                        metaLine.style.fontSize = '0.8rem';
                        metaLine.style.color = '#4b5563';
                        metaLine.textContent = [exp.company, exp.dates].filter(Boolean).join(' ‚Äî ');

                        wrapper.appendChild(titleLine);
                        if (metaLine.textContent) wrapper.appendChild(metaLine);

                        if (exp.bullets.length) {
                            const ul = document.createElement('ul');
                            ul.style.marginTop = '0.25rem';
                            ul.style.paddingLeft = '1rem';
                            ul.style.listStyle = 'disc';
                            exp.bullets.forEach(b => {
                                const li = document.createElement('li');
                                li.textContent = b;
                                ul.appendChild(li);
                            });
                            wrapper.appendChild(ul);
                        }
                        expContainer.appendChild(wrapper);
                    });
                }

                // Education
                const eduContainer = document.getElementById('resume-education');
                eduContainer.innerHTML = '';
                const edus = [1,2].map(i => ({
                    school: document.getElementById(`edu${i}-school`).value.trim(),
                    degree: document.getElementById(`edu${i}-degree`).value.trim(),
                    year:   document.getElementById(`edu${i}-year`).value.trim()
                })).filter(e => e.school || e.degree || e.year);

                if (edus.length === 0) {
                    eduContainer.innerHTML = `
                        <div>
                            <div style="font-weight:600;">Institution Name</div>
                            <div style="font-size:0.8rem; color:#4b5563;">Degree or Program ‚Ä¢ Year</div>
                        </div>
                    `;
                } else {
                    edus.forEach(e => {
                        const wrapper = document.createElement('div');
                        wrapper.style.marginBottom = '0.4rem';

                        const school = document.createElement('div');
                        school.style.fontWeight = '600';
                        school.textContent = e.school || 'Institution';

                        const detail = document.createElement('div');
                        detail.style.fontSize = '0.8rem';
                        detail.style.color = '#4b5563';
                        detail.textContent = [e.degree, e.year].filter(Boolean).join(' ‚Ä¢ ');

                        wrapper.appendChild(school);
                        if (detail.textContent) wrapper.appendChild(detail);
                        eduContainer.appendChild(wrapper);
                    });
                }
            }

            inputs.forEach(input => {
                input.addEventListener('input', updatePreview);
            });

            if (clearBtn) {
                clearBtn.addEventListener('click', () => {
                    inputs.forEach(input => { input.value = ''; });
                    updatePreview();
                });
            }

            updatePreview();
        }
    </script>

</body>
</html>
