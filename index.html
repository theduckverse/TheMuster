<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Soldiers of Valor (Veteran Resource Center) - Tactical Display</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
    /* ========== GLOBAL THEME / HUD ========== */
    :root {
        --military-green: #1f3324;
        --military-green-light: #2f4a35;
        --hud-accent: #31ff7a;
    }

    body {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        background-color: #020617; /* slate-950 */
        color: #e2e8f0; /* slate-200 */

        /* layered HUD background: vignette + grid + glow */
        background-image:
            radial-gradient(circle at top left, rgba(22, 163, 74, 0.25), transparent 55%),
            radial-gradient(circle at bottom right, rgba(56, 189, 248, 0.2), transparent 60%),
            linear-gradient(
                to bottom,
                rgba(15, 23, 42, 0.95),
                rgba(15, 23, 42, 0.98)
            );
        background-attachment: fixed;
        background-size: cover;
        background-position: center;
    }

    /* subtle scanline overlay */
    body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background-image:
            repeating-linear-gradient(
                to bottom,
                rgba(148, 163, 184, 0.10),
                rgba(148, 163, 184, 0.10) 1px,
                transparent 2px,
                transparent 3px
            );
        opacity: 0.12;
        z-index: -1;
    }

    /* faint grid overlay */
    body::after {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background-image:
            linear-gradient(to right, rgba(30, 64, 175, 0.22) 1px, transparent 1px),
            linear-gradient(to bottom, rgba(30, 64, 175, 0.22) 1px, transparent 1px);
        background-size: 64px 64px;
        opacity: 0.18;
        z-index: -2;
    }

    .hud-border {
        border: 1px solid rgba(49, 255, 122, 0.25);
    }

    .hud-glow {
        text-shadow: 0 0 8px rgba(49, 255, 122, 0.4);
    }

    .nav-shadow {
        box-shadow: 0 3px 6px rgba(0,0,0,0.35);
    }

    /* ========== HEADER / CRISIS CARD ========== */
    .crisis-card {
        background: radial-gradient(circle at top, #b91c1c 0%, #7f1d1d 40%, #111827 90%);
        box-shadow:
            0 0 20px rgba(248, 113, 113, 0.4),
            0 0 60px rgba(248, 113, 113, 0.15);
        border-bottom: 2px solid rgba(248, 113, 113, 0.85);
    }

    .crisis-card h1 {
        letter-spacing: 0.12em;
        text-shadow:
            0 0 12px rgba(248, 250, 252, 0.7),
            0 0 24px rgba(248, 113, 113, 0.6);
    }

    .crisis-card a {
        border: 1px solid rgba(248, 250, 252, 0.18);
        text-shadow: 0 0 6px rgba(15, 23, 42, 0.9);
    }

    /* ========== GENERIC PANELS / CARDS ========== */
    .panel {
        background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.14), rgba(15, 23, 42, 0.98));
        border-radius: 0.85rem;
        border: 1px solid rgba(148, 163, 184, 0.55);
        box-shadow:
            0 0 0 1px rgba(15, 23, 42, 0.9),
            0 0 22px rgba(22, 163, 74, 0.25),
            0 0 60px rgba(15, 23, 42, 0.9);
        backdrop-filter: blur(8px);
    }

    .panel h2,
    .panel h3 {
        letter-spacing: 0.06em;
    }

    .accent-green {
        color: #22c55e;
        /* emerald-500 */
    }

    .accent-orange {
        color: #f97316;
        /* orange-500 */
    }

    /* ========== TABS ========== */
    .tab-button {
        flex: 1;
        padding: 0.5rem 0.25rem;
        text-align: center;
        font-size: 0.65rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.09em;
        border-bottom: 2px solid rgba(30, 64, 175, 0.6);
        background: rgba(15, 23, 42, 0.95);
        color: rgba(148, 163, 184, 0.9);
        transition:
            background-color 0.18s ease,
            color 0.18s ease,
            border-color 0.18s ease,
            box-shadow 0.18s ease;
    }

    .tab-button:hover {
        background: rgba(30, 64, 175, 0.6);
        color: #e5e7eb;
        box-shadow: 0 0 14px rgba(59, 130, 246, 0.45);
    }

    .tab-active {
        border-color: #22c55e;
        color: #bbf7d0;
        background: radial-gradient(circle at top, rgba(21, 128, 61, 0.85), rgba(15, 23, 42, 0.96));
        box-shadow:
            0 0 0 1px rgba(21, 128, 61, 0.6),
            0 0 20px rgba(34, 197, 94, 0.55);
    }

    .tab-inactive {
        opacity: 0.8;
    }

    /* ========== BUTTONS ========== */
    .btn-primary {
        background: radial-gradient(circle at top, #22c55e, #15803d);
        color: #020617;
        padding: 0.65rem 1rem;
        border-radius: 0.6rem;
        font-weight: 800;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        border: 1px solid rgba(187, 247, 208, 0.9);
        box-shadow:
            0 0 0 1px rgba(21, 128, 61, 0.75),
            0 0 18px rgba(34, 197, 94, 0.6);
        transition:
            transform 0.12s ease,
            box-shadow 0.12s ease,
            filter 0.12s ease,
            background 0.12s ease;
    }

    .btn-primary:hover:not(:disabled) {
        transform: translateY(-1px);
        filter: brightness(1.1);
        box-shadow:
            0 0 0 1px rgba(74, 222, 128, 0.9),
            0 0 26px rgba(34, 197, 94, 0.85);
    }

    .btn-primary:disabled {
        background: radial-gradient(circle at top, #374151, #111827);
        color: #9ca3af;
        border-color: rgba(75, 85, 99, 0.8);
        box-shadow: none;
        cursor: not-allowed;
    }

    .btn-secondary {
        background: rgba(15, 23, 42, 0.95);
        color: #e5e7eb;
        padding: 0.5rem 0.9rem;
        border-radius: 0.55rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.07em;
        border: 1px solid rgba(148, 163, 184, 0.7);
        box-shadow:
            0 0 0 1px rgba(15, 23, 42, 0.95),
            0 0 14px rgba(30, 64, 175, 0.55);
        transition:
            background 0.18s ease,
            box-shadow 0.18s ease,
            border-color 0.18s ease;
    }

    .btn-secondary:hover:not(:disabled) {
        background: rgba(30, 64, 175, 0.75);
        border-color: rgba(191, 219, 254, 0.95);
        box-shadow:
            0 0 0 1px rgba(59, 130, 246, 0.9),
            0 0 20px rgba(96, 165, 250, 0.9);
    }

    .btn-secondary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        box-shadow: none;
    }

    /* ========== INPUTS / TEXTAREAS ========== */
    input[type="text"],
    textarea,
    select { /* Added select here to match custom styling */
        background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 1));
        border: 1px solid rgba(34, 197, 94, 0.7);
        color: #bbf7d0;
        padding: 0.7rem 0.8rem;
        border-radius: 0.65rem;
        font-size: 0.85rem;
        outline: none;
        box-shadow: 0 0 0 1px rgba(15, 23, 42, 1);
        transition:
            border-color 0.16s ease,
            box-shadow 0.16s ease,
            background 0.16s ease;
    }

    input[type="text"]::placeholder,
    textarea::placeholder {
        color: rgba(148, 163, 184, 0.7);
    }

    input[type="text"]:focus,
    textarea:focus,
    select:focus { /* Added select here to match custom styling */
        border-color: #f97316;
        box-shadow:
            0 0 0 1px rgba(15, 23, 42, 1),
            0 0 18px rgba(249, 115, 22, 0.7);
        background: radial-gradient(circle at top left, rgba(22, 163, 74, 0.22), rgba(15, 23, 42, 0.98));
    }

    /* ========== LOADING RING ========== */
    .loading-ring {
        border: 4px solid rgba(30, 64, 175, 0.6);
        border-top: 4px solid #22c55e;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        box-shadow: 0 0 18px rgba(34, 197, 94, 0.7);
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* ========== MODAL OVERLAY ========== */
    .modal-overlay {
        position: fixed;
        inset: 0;
        background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.98));
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 50;
        backdrop-filter: blur(10px);
    }

    /* ========== MESSAGE BOX / TOAST ========== */
    .message-box {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 60;
        opacity: 0;
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
    }

    .message-box.show {
        opacity: 1;
        transform: translateX(-50%) translateY(-3px);
    }

    /* ========== RESOURCE LIST HUD TWEAKS ========== */
    #resource-section h2 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.95rem;
    }

    #resource-section h2::before {
        content: "‚óâ";
        font-size: 0.85rem;
        color: #22c55e;
        text-shadow: 0 0 12px rgba(34, 197, 94, 0.8);
    }

    #resource-list li {
        position: relative;
        overflow: hidden;
    }

    #resource-list li::before {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
        background: linear-gradient(
            120deg,
            transparent 0%,
            rgba(34, 197, 94, 0.06) 40%,
            rgba(59, 130, 246, 0.05) 60%,
            transparent 100%
        );
        opacity: 0;
        transition: opacity 0.18s ease-in-out;
    }

    #resource-list li:hover::before {
        opacity: 1;
    }

    #resource-list .accent-orange {
        text-shadow: 0 0 10px rgba(249, 115, 22, 0.9);
    }

    #resource-list a {
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-size: 0.7rem;
    }

    #resource-list a:hover {
        text-shadow: 0 0 9px rgba(34, 197, 94, 0.9);
    }
    </style>
</head>
<body class="min-h-screen flex flex-col">

   <header class="p-4 bg-red-700/30 text-white text-center shadow-md border-b border-red-500">
    <h1 class="text-3xl font-extrabold tracking-widest hud-glow">
        SOLDIERS OF VALOR
    </h1>
    <p class="text-sm opacity-80">OPERATIONAL STATUS: HIGH</p>

    <a href="tel:988"
       class="mt-3 inline-flex items-center space-x-2 bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-md font-bold transition shadow-xl">
       <span>üö® CRISIS LINE: CALL 988</span>
    </a>
</header>

<div id="auth-status" class="bg-green-900/40 text-green-400 p-2 text-xs text-center border-b 
border-green-700">
    :: INITIALIZING SECURE LINK ::
</div>

<nav class="sticky top-0 z-50 bg-[#0f1a14] nav-shadow border-b border-green-900">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3">

        <span class="text-lg font-bold text-[var(--hud-green)] hud-glow tracking-widest">
            COMMAND CONSOLE
        </span>

        <input id="sov-search"
               type="text"
               placeholder="Search benefits, jobs, resources..."
               onkeydown="if(event.key==='Enter'){performSearch()}"
               class="hidden md:block px-3 py-2 bg-[#0c140f] text-gray-300 hud-border rounded focus:outline-none w-72" />

        <div class="hidden md:flex space-x-6 text-sm uppercase tracking-widest">
            <button class="hover:text-[var(--hud-green)]" onclick="switchTab('goals')">Mission Planner</button>
            <button class="hover:text-[var(--hud-green)]" onclick="switchTab('map')">Local Resources</button>
            <button class="hover:text-[var(--hud-green)]" onclick="switchTab('employment')">Employment</button>
            <button class="hover:text-[var(--hud-green)]" onclick="switchTab('benefits')">Benefits</button>
            <button class="hover:text-[var(--hud-green)]" onclick="switchTab('muster')">The Muster</button>
        </div>

    </div>
</nav>

<section class="hero-bg py-16 text-center">
    <h1 class="text-4xl md:text-5xl font-extrabold text-[var(--hud-green)] hud-glow tracking-wide">
        YOUR TACTICAL ADVANTAGE IN CIVILIAN LIFE
    </h1>

    <p class="mt-6 text-gray-300 text-lg max-w-2xl mx-auto">
        Real-time resources, mission-ready planning, employment translation, and community support ‚Äî
        all inside a unified HUD-style veteran platform.
    </p>

    <div class="mt-8 flex justify-center space-x-4">
        <button onclick="switchTab('goals')" class="btn-primary">
            Launch Mission Planner
        </button>
        <button onclick="switchTab('map')" class="btn-secondary">
            Scan Local Resources
        </button>
    </div>
</section>


    <nav class="flex w-full bg-[#1a202c] shadow-md z-30 sticky top-[56px]">
        <button id="tab-map" class="tab-button tab-inactive" onclick="window.switchTab('map')">
            :: RESOURCE LOCATOR ::
        </button>
        <button id="tab-benefits" class="tab-button tab-inactive" onclick="window.switchTab('benefits')">
            :: BENEFITS PROTOCOL ::
        </button>
        <button id="tab-goals" class="tab-button tab-inactive" onclick="window.switchTab('goals')">
            :: MISSION PLANNER ::
        </button>
        <button id="tab-muster" class="tab-button tab-inactive" onclick="window.switchTab('muster')">
            :: THE MUSTER ::
        </button>
        <button id="tab-employment" class="tab-button tab-active" onclick="window.switchTab('employment')">
            :: EMPLOYMENT HUB ::
        </button>
    </nav>

    <main class="flex-grow p-4 space-y-4 max-w-6xl mx-auto">

        <section id="content-map" class="hidden space-y-4">
            <button id="view-history-btn" class="btn-secondary w-full" disabled>
                ACCESS LOG HISTORY (LOADING...)
            </button>

            <div id="location-card" class="panel p-4 space-y-3">
                <h2 class="text-xl font-semibold accent-green flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                         viewBox="0 0 24 24" fill="none" stroke="currentColor"
                         stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                         class="lucide lucide-target">
                        <circle cx="12" cy="12" r="10"/>
                        <circle cx="12" cy="12" r="6"/>
                        <circle cx="12" cy="12" r="2"/>
                    </svg>
                    <span>TARGET: Local Resources</span>
                </h2>
                <div id="location-info" class="text-gray-300">
                    <p>Execute location scan to identify nearby services.</p>
                    <p id="current-location" class="font-medium mt-2 hidden">
                        COORDS: <span id="lat-long" class="accent-orange"></span>
                    </p>
                </div>
                <button id="find-location-btn" class="btn-primary w-full" disabled>
                    EXECUTE LOCATION SCAN
                </button>
                <div id="loading-indicator" class="hidden flex justify-center py-2">
                    <div class="loading-ring"></div>
                </div>
            </div>

            <div id="resource-section" class="panel p-4 space-y-3 hidden">
                <h2 class="text-xl font-semibold accent-green">LOCAL RESOURCE SCAN: LIVE DATA</h2>
                <p class="text-sm text-gray-400">STATUS: synced with secure Firebase node.</p>
                <ul id="resource-list" class="space-y-4"></ul>
            </div>
        </section>

        <section id="content-benefits" class="hidden space-y-6">
            <h2 class="text-2xl font-bold accent-green border-b border-gray-600 pb-2 font-mono">BENEFITS PROTOCOL: CLAIMS</h2>
            <p class="text-gray-400 text-sm">Filing a disability claim is mission-critical.
                The steps provided are general knowledge and in no way constitute legal advice.
                Every outcome is different and we share our knowledge to help get the best outcome for our veteran brothers and sisters.
                Feel free to email us if you have anything to add to this sequence.</p>
            <div class="panel p-4 space-y-2 border-l-4 border-green-500">
                <div class="flex items-center space-x-2">
                    <span class="text-xl font-extrabold accent-orange">01</span>
                    <h3 class="font-bold text-lg accent-green">DATA ACQUISITION</h3>
                </div>
                <ul class="list-disc ml-5 text-sm text-gray-400 space-y-1">
                    <li>***The best practice before filing a claim is to seek outside medical attention.*** If it is a PTSD claim, seek mental health providers ahead of time, if it is an injury, seek help from a specialist before filing, this step alone is crucial in establishing your nexus, which is discussed later in these steps.</li>
                    <li>**Service Connection:** Acquire DD-214 and Service Treatment Records (STRs).You can request records from the National Archives online, by mail, or by fax.
                        (If you‚Äôre submitting an application for VA benefits, VA will request your DD214 for you when they receive your application. You don‚Äôt need to do this yourself through the National Archives.) If you already have a copy, you can upload it with your claim.
                        You can request your military service records online using the National Archives‚Äô eVetRecs tool.
                        When you get to eVetRecs, select Make a new request.
                        There is also a link and instructions here (<a href="https://www.va.gov/records/get-military-service-records/" target="_blank" class="accent-orange hover:text-red-500">MILITARY SERVICE RECORDS</a>).
                        You‚Äôll then need to sign in with an identity-verified ID.me account.
                        The National Archives may ask you to take a ‚Äúlive selfie‚Äù photo with your smartphone as an added step to verification.
                        Option 2: Fill out the National Archive‚Äôs request form (to mail or fax) Fill out a Request Pertaining to Military Records (Standard Form 180).
                        You can get the form here (<a href="https://www.va.gov/find-forms/about-form-sf180/" target="_blank" class="accent-orange hover:text-red-500">VA FORM SF180</a>).
                        Mail or fax your completed form to the appropriate address or fax number listed on the last page of the form.
                        To find the right address or fax number for you, you‚Äôll need to use the first chart on that page to find your branch of service, separation date, and type of record.
                    </li>
                    <li>**Medical Evidence:** Secure your Service Treatment Records (STRs): These documents detail any medical issues you experienced during your active duty.
                        They serve as direct evidence of in-service events or injuries that may have contributed to your current condition.
                        VA and Private Medical Records: Include records from both VA facilities and private healthcare providers.
                        These documents help establish a history of treatment and demonstrate the progression and severity of your condition.
                        Independent Medical Opinions (IMOs) and NEXUS Letters: A NEXUS letter from a qualified medical professional is crucial.
                        It should explicitly state whether your condition is "at least as likely as not" related to your military service, providing a clear connection for the VA.
                        Diagnostic Test Results: Include results from X-rays, MRIs, lab tests, and other diagnostic procedures that confirm your diagnosis.
                        This evidence is particularly important for conditions like PTSD, chronic pain, and orthopedic injuries.
                        Lay Evidence (Buddy Statements): Statements from fellow service members, family, or friends who can attest to the onset or worsening of your condition can support your medical evidence, especially if your service records are incomplete.</li>
                    <li>**Nexus:** As stated above, this step is crucial in linking current status to service actions (e.g., doctor's statement).
                        (<a target="_blank" class="accent-orange hover:text-red-500">!!! BE AWARE!!!</a>) Several companies are filing claims for veterans' benefits, often charging fees for services that are legally required to be free.
                        Here are some key points: For-Profit Consultants: Many for-profit companies charge veterans fees for help filing disability claims, operating in a legal loophole where only accredited agents and Veterans Service Organizations (VSOs) can assist with claims.
                        Legislative Actions: States like Maine, New Jersey, and New York have passed laws to crack down on these practices, while Louisiana has allowed companies to charge up to $12,500 for services that should be free.
                        Opposition to Legislation: Advocacy groups, including the Veterans of Foreign Wars, oppose bills that would allow for-profit companies to charge veterans for initial claims assistance, arguing that free help is already available through accredited representatives.
                        Predatory Practices: Some companies exploit veterans' trust by offering misleading services, often resulting in financial strain and limited improvement in claims outcomes.
                        These practices raise significant concerns about the integrity of the veterans' claims process and the exploitation of vulnerable populations.!!!
                        Please look into these with caution if you decide to go this route.
                        Although some say you do not have to pay unless your claim is accepted, many take large portions or all of the backpay you would recieve.
                    </li>
                </ul>
            </div>
            <div class="panel p-4 space-y-2 border-l-4 border-green-500">
                <div class="flex items-center space-x-2">
                    <span class="text-xl font-extrabold accent-orange">02</span>
                    <h3 class="font-bold text-lg accent-green">SUBMISSION ROUTE</h3>
                </div>
                <ul class="list-disc ml-5 text-sm text-gray-400 space-y-1">
                    <li>**Fast Track:** Utilize the VA digital portal (<a href="https://www.va.gov" target="_blank" class="accent-orange hover:text-red-500">VA.gov</a>).
                        Although this is a "fasttrack", the VA takes time to review all of your information.
                        This is really only a "fast track" in the sense that it is an easy way to submit your application.
                        All claims are different and some may be faster than others. Be patient, but file your Intent To File ASAP.
                        More on this later. </li>
                    <li>**Priority Channel:** Contact a Veterans Service Officer (VSO) for free, expert support.
                        This is a prefered channel. VSO's are there to help and navigate the VA system of forms and filing.
                        One of the issues that can arise though is the speed at which you can be seen.
                        Depending on location and number of VSO's, it can take some time to schedule to meet and go throguh your filing process.</li>
                    <li>(<a target="_blank" class="accent-orange hover:text-red-500">!!!Effective Date Lock!!!</a>): File an Intent to File immediately!!!
                        You can do so here (<a href="https://www.va.gov/supporting-forms-for-claims/intent-to-file-form-21-0966/introduction" target="_blank" class="accent-orange hover:text-red-500">INTENT TO FILE</a>).
                        An intent to file is a formal notification to the VA that a veteran plans to submit a claim for disability compensation, pension, or survivors' benefits.
                        This process allows veterans to gather necessary documentation while protecting the earliest possible effective date for their claim, which can lead to retroactive benefits if the claim is approved.
                        This means if you are getting backpay it will be retroactive to the date of your intent to file.
                    </li>
                </ul>
            </div>
            <div class="panel p-4 space-y-2 border-l-4 border-green-500">
                <div class="flex items-center space-x-2">
                    <span class="text-xl font-extrabold accent-orange">03</span>
                    <h3 class="font-bold text-lg accent-green">C&P EVALUATION</h3>
                </div>
                <ul class="list-disc ml-5 text-sm text-gray-400 space-y-1">
                    <li>**Compliance:** Attend all mandated Compensation & Pension (C&P) exams.
                        A claim (C&P) exam isn‚Äôt like a normal medical exam.
                        The provider won‚Äôt treat you for any illness or injury, give you referrals to other providers, or prescribe medicine.
                        The purpose of the exam is to gather information that will help the VA make a decision on your claim.
                        During your exam, the provider may do any or all of these things: Perform a basic physical exam.
                        (This may or may not include physical contact) Ask you questions based on the medical records in your claim file.
                        These may include questions from the Disability Benefits Questionnaire (DBQ) for each service-connected condition you‚Äôre claiming.
                        Ask you to get other tests (like X-rays or blood work), at no cost to you.
                        Note: If you have questions about what‚Äôs happening during your exam, you can ask the provider.
                        But they can‚Äôt answer questions about the claims process, tell you the exam results, or make decisions about your claim.
                    </li>
                    <li>**Reporting:** Describe your condition's CURRENT impact on daily function. Make sure to be thorough in your descriptions.
                        If you have trouble sleeping, let them know how many nights in any given week you may have trouble.
                        The more info given, the better the VA can assess and treat when your claim is accepted.
                    </li>
                </ul>
            </div>
            <div class="panel p-4 space-y-2 border-l-4 border-green-500">
                <div class="flex items-center space-x-2">
                    <span class="text-xl font-extrabold accent-orange">04</span>
                    <h3 class="font-bold text-lg accent-green">RESOLUTION & APPEAL</h3>
                </div>
                <ul class="list-disc ml-5 text-sm text-gray-400 space-y-1">
                    <li>**Review:** Confirm the rating accuracy upon decision.</li>
                    <li>**Recourse:** If denied, consult VSO immediately to initiate Supplemental, HLR, or Board Appeal.</li>
                </ul>
            </div>
            <p class="text-xs text-gray-500 pt-2">:: DISCLOSURE: THIS IS A GUIDANCE TOOL, NOT OFFICIAL VA DIRECTIVE.
                CONSULT VSO. ::</p>
        </section>

        <section id="content-goals" class="hidden space-y-4">
            <h2 class="text-2xl font-bold accent-green border-b border-gray-600 pb-2 font-mono">
                MISSION PLANNER
            </h2>
            <p class="text-gray-400 text-sm">
                Define your objective and track your steps.
                Progress is logged in your secure private cloud. </p>
            <div class="panel p-4 space-y-3">
                <h3 class="text-xl font-semibold accent-green border-b border-gray-600 pb-2">
                    INPUT NEW OBJECTIVE
                </h3>
                <input type="text" id="goal-title" placeholder="E.g., Complete my degree, Find a career in tech, Improve fitness" maxlength="80" />
                <div id="milestone-inputs" class="space-y-2">
                    <input type="text" data-milestone="1" placeholder="Step 1: Define specific task" class="text-sm" />
                    <input type="text" data-milestone="2" placeholder="Step 2: Define specific task" class="text-sm" />
                    <input type="text" data-milestone="3" placeholder="Step 3: Define specific task" class="text-sm" />
                </div>
                <button id="add-goal-btn" class="btn-primary w-full" disabled>
                    SAVE NEW MISSION
                </button>
            </div>
            <div class="space-y-3">
                <h3 class="text-xl font-semibold accent-green border-b border-gray-600 pb-2">
                    ACTIVE MISSIONS
                </h3>
                <div id="goal-list-container" class="space-y-4">
                    <p 
                        id="goals-loading" class="text-center text-gray-500 py-4"> Awaiting missions... Initializing link. </p>
                </div>
            </div>
        </section>

        <section id="content-muster" class="hidden space-y-4">
            <h2 class="text-2xl font-bold accent-green border-b border-gray-600 pb-2 font-mono">
                THE MUSTER (SECURE CHANNEL)
            </h2>
            <p class="text-gray-400 text-sm">
                Post tactical status updates and community announcements.
                All communications are logged and secured.
            </p>
            <div class="panel p-4 space-y-3">
                <h3 class="text-xl font-semibold accent-orange border-b border-gray-600 pb-2">
                    TRANSMIT MESSAGE
                </h3>
                <textarea id="huddle-post-input" rows="3" placeholder="What's your SITREP? Post an update..." maxlength="500"></textarea>
                <button id="post-message-btn" class="btn-secondary w-full" disabled>
                    SECURE TRANSMISSION
                </button>
            </div>
            <div class="space-y-3">
                <h3 class="text-xl font-semibold accent-green border-b border-gray-600 pb-2">
                    COMMUNITY FEED
                </h3>
                <div id="community-feed" class="space-y-4">
                    <p id="muster-loading" class="text-center text-gray-500 py-4"> 
                        Connecting to secure channel... 
                    </p>
                </div>
            </div>
        </section>

        <section id="content-employment" class="space-y-4">
            <h2 class="text-2xl font-bold accent-green border-b border-gray-600 pb-2 font-mono">
                EMPLOYMENT HUB
            </h2>
            <p class="text-gray-400 text-sm">
                Translate your military skills into in-demand civilian qualifications, and build your mission-ready resume.
            </p>

            <div class="panel p-4 space-y-3">
                <h3 class="text-xl font-semibold accent-orange border-b border-gray-600 pb-2">
                    MILITARY CODE TRANSLATOR
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="branch-select" class="font-bold text-xs uppercase accent-green">Service Branch</label>
                        <select id="branch-select" class="w-full mt-1 p-2">
                            <option value="ARMY">Army (MOS)</option>
                            <option value="NAVY">Navy (Rate)</option>
                            <option value="USMC">Marine Corps (MOS)</option>
                            <option value="USAF">Air Force (AFSC)</option>
                            <option value="USCG">Coast Guard (Rate)</option>
                            <option value="GENERIC">General Title/Rank</option>
                        </select>
                    </div>

                    <div class="md:col-span-2">
                        <label for="mos-input-code" class="font-bold text-xs uppercase accent-green">MOS/RATE/AFSC/TITLE</label>
                        <input id="mos-input-code" type="text" placeholder="E.g., 68W, HM, 2A6X2, PLATOON LEADER" class="w-full mt-1">
                    </div>
                </div>

                <button id="mos-translate-btn" class="btn-primary w-full mt-2">
                    EXECUTE TRANSLATION
                </button>

                <div id="mos-loading-spinner" class="hidden flex justify-center py-4">
                    <div class="loading-ring"></div>
                </div>

                <div id="translation-result" class="hidden panel p-4 space-y-3 border-l-4 border-orange-500">
                    <h4 id="job-title-output" class="text-xl font-bold accent-orange border-b border-gray-600 pb-2"></h4>
                    <div id="skills-output" class="text-gray-300"></div>
                </div>
            </div>
            <div class="panel p-4 space-y-3">
                <h3 class="text-xl font-semibold accent-orange border-b border-gray-600 pb-2">
                    RESUME GENERATOR (DOD-TO-CIV)
                </h3>
                <div>
                    <label class="font-bold">Full Name</label>
                    <input id="resume-name" type="text" placeholder="John Doe" class="w-full mt-1">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="font-bold">Email</label>
                        <input id="resume-email" type="text" placeholder="you@example.com" class="w-full mt-1">
                    </div>
                    <div>
                        <label class="font-bold">Phone</label>
                        <input id="resume-phone" type="text" placeholder="555-555-5555" class="w-full mt-1">
                    </div>
                </div>
                <div>
                    <label class="font-bold">MOS / RATE / JOB TITLE</label>
                    <input id="resume-mos" type="text" placeholder="68W, Infantry, Platoon Leader" class="w-full mt-1">
                </div>
                <div>
                    <label class="font-bold">Professional Summary</label>
                    <textarea id="resume-summary" rows="3" placeholder="Short intro about your experience and strengths."
                        class="w-full mt-1"></textarea>
                </div>
                <div>
                    <label class="font-bold">Experience</label>
                    <textarea id="resume-experience" rows="4" placeholder="List your military or civilian experience here."
                        class="w-full mt-1"></textarea>
                </div>
                <div>
                    <label class="font-bold">Education / Certifications</label>
                    <textarea id="resume-education" rows="3" placeholder="School, degrees, certificates, military schools."
                        class="w-full mt-1"></textarea>
                </div>
                <div>
                    <label class="font-bold">Skills (Comma Separated)</label>
                    <textarea id="resume-skills" rows="3" placeholder="Leadership, Logistics, Training, Communication" class="w-full mt-1"></textarea>
                </div>
                <button id="download-resume-btn" class="bg-green-500 hover:bg-green-600 text-gray-900 font-bold py-3 px-4 rounded shadow-md w-full"> 
                    DOWNLOAD RESUME (PDF) 
                </button>
            </div>

            <div class="space-y-3">
                <h3 class="text-xl font-semibold accent-green border-b border-gray-600 pb-2">
                    TOP EMPLOYMENT ASSETS
                </h3>
                <ul class="list-disc ml-5 text-sm text-gray-400 space-y-2">
                    <li><a href="https://www.dol.gov/agencies/vets" target="_blank" class="accent-orange hover:text-green-500">Department of Labor VETS</a> - Transition Assistance Program (TAP)</li>
                    <li><a href="https://www.onetonline.org/" target="_blank" class="accent-orange hover:text-green-500">O*NET Online</a> - Civilian Job Code Crosswalk</li>
                    <li><a href="https://www.hireheroesusa.org/" target="_blank" class="accent-orange hover:text-green-500">Hire Heroes USA</a> - Resume & Job Search Support</li>
                    <li><a href="https://www.linkedin.com/in/veterans" target="_blank" class="accent-orange hover:text-green-500">LinkedIn for Veterans</a> - Free Premium Access & Mentorship</li>
                </ul>
            </div>

        </section>

        <div id="history-modal" class="modal-overlay hidden">
            <div class="panel p-6 w-11/12 md:w-3/4 lg:w-1/2 max-h-[80vh] overflow-y-auto space-y-4">
                <h3 class="text-2xl font-bold accent-green border-b border-gray-600 pb-2">
                    :: OPERATIONAL LOG HISTORY ::
                </h3>
                <div id="history-list" class="space-y-3">
                    </div>
                <button id="close-history-btn" class="btn-secondary w-full">
                    CLOSE LOG
                </button>
            </div>
        </div>

    </main>

    <div id="message-box" class="message-box hidden">
        <div id="message-content"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script type="module">
        // Import Firebase functions (assuming you have your Firebase setup here)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getDatabase, ref, onValue, set, push, serverTimestamp, runTransaction } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // --- FIREBASE CONFIGURATION (Placeholder/Original) ---
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // Global State
        let userId = null;
        let isAuthReady = false;

        // DOM Elements
        const authStatusEl = document.getElementById('auth-status');
        const findLocationBtn = document.getElementById('find-location-btn');
        const addGoalBtn = document.getElementById('add-goal-btn');
        const postMessageBtn = document.getElementById('post-message-btn');
        const viewHistoryBtn = document.getElementById('view-history-btn');
        const historyListEl = document.getElementById('history-list');
        const goalListContainerEl = document.getElementById('goal-list-container');
        const goalTitleInput = document.getElementById('goal-title');
        const milestoneInputs = document.getElementById('milestone-inputs').querySelectorAll('input');
        const goalsLoadingEl = document.getElementById('goals-loading');
        const huddlePostInput = document.getElementById('huddle-post-input');
        const communityFeedEl = document.getElementById('community-feed');
        const musterLoadingEl = document.getElementById('muster-loading');
        
        // --- MESSAGE TOAST ---
        function showMessage(text, isError = false) {
            const msgBox = document.getElementById('message-box');
            const msgContent = document.getElementById('message-content');
            if (isError) {
                msgContent.className = 'bg-red-700 text-white p-3 rounded-md shadow-xl text-sm font-medium border border-red-500';
            } else {
                msgContent.className = 'bg-green-700 text-white p-3 rounded-md shadow-xl text-sm font-medium border border-green-500';
            }
            msgContent.textContent = text;
            msgBox.classList.add('show');
            msgBox.classList.remove('hidden');
            setTimeout(() => {
                msgBox.classList.remove('show');
                setTimeout(() => msgBox.classList.add('hidden'), 300);
            }, 3000);
        }

        // --- DB PATH HELPERS ---
        const getPrivateRef = (path) => {
            if (!db || !userId) return null;
            return ref(db, `users/${userId}/${path}`);
        };

        const getPublicRef = (path) => {
            if (!db) return null;
            return ref(db, `public/${path}`);
        };


        // --- MOS TRANSLATION DATA (REPLACED/UPDATED) ---
        // NOTE: This object now uses the BRANCH:CODE format for robustness.
        const mockTranslations = {
            // Army MOS Examples
            "ARMY:68W": {
                title: "EMERGENCY MEDICAL TECHNICIAN / HEALTHCARE ASSISTANT",
                skills: ["Advanced Trauma Care", "Patient Triage & Assessment", "Emergency Field Operations", "Basic Life Support (BLS)", "Medical Logistics Management"]
            },
            "ARMY:42A": {
                title: "HUMAN RESOURCES SPECIALIST / PERSONNEL MANAGER",
                skills: ["Personnel Records Management", "Benefits Administration", "Recruitment & Onboarding", "Confidential Information Handling", "Workforce Scheduling"]
            },
            "ARMY:92Y": {
                title: "LOGISTICS & SUPPLY CHAIN MANAGER / WAREHOUSE SUPERVISOR",
                skills: ["Inventory Control (Millions of Dollars)", "Supply Chain Optimization", "Warehouse Safety & Operations", "Procurement & Budgeting", "Team Leadership (10+ Personnel)"]
            },
            "ARMY:11B": {
                title: "SECURITY SPECIALIST / OPERATIONS MANAGER / TRAINER",
                skills: ["Risk Mitigation & Analysis", "Crisis Management & Response", "Team Leadership (9-40 Personnel)", "Physical Security", "Advanced Training & Instruction"]
            },
            // Navy Rate Examples
            "NAVY:HM": {
                title: "HOSPITAL CORPSMAN / CLINICAL ASSISTANT / HEALTHCARE ADMINISTRATOR",
                skills: ["Patient Care and Triage", "Medical Record Keeping (HIPAA/HITECH)", "Immunization & Phlebotomy", "Dental Assistant Procedures", "Emergency First Aid"]
            },
            "NAVY:EO": {
                title: "HEAVY EQUIPMENT OPERATOR / CONSTRUCTION FOREMAN",
                skills: ["Earth Moving Equipment Operation", "Site Preparation & Grading", "Safety Compliance (OSHA)", "Maintenance & Repair Scheduling", "Civil Engineering Support"]
            },
            // Air Force AFSC Example
            "USAF:2A6X2": { // Aerospace Ground Equipment Mechanic
                title: "AIRCRAFT SUPPORT MECHANIC / FIELD SERVICE TECHNICIAN",
                skills: ["Diagnostic Testing & Troubleshooting", "Hydraulic & Pneumatic Systems Maintenance", "Safety Compliance (OSHA/EPA)", "Technical Documentation & Reporting", "Preventive Maintenance Scheduling"]
            },
            // Marine Corps MOS
            "USMC:0311": {
                title: "CRISIS MANAGEMENT / PHYSICAL SECURITY SPECIALIST / INSTRUCTOR",
                skills: ["Risk Assessment & Mitigation", "Team Leadership in Austere Environments", "Tactical Communications", "Advanced Weapons Systems Proficiency", "Personnel Training & Development"]
            },
            // Generic/Rank/Title Lookups (Fallback for non-code inputs)
            "GENERIC:PLATOON LEADER": {
                title: "PROJECT MANAGER / OPERATIONS DIRECTOR",
                skills: ["Strategic Planning", "Team Leadership (20+ Personnel)", "Logistics & Supply Chain Management", "Budget Allocation & Oversight"]
            },
            "GENERIC:NCOIC": {
                title: "SUPERVISOR / SHIFT MANAGER / FIRST-LINE LEADER",
                skills: ["Employee Performance Evaluation", "Workflow Management", "Conflict Resolution", "Regulatory Compliance", "Training & Development"]
            },
            "GENERIC:LOGISTICS": {
                title: "SUPPLY CHAIN ANALYST / INVENTORY SPECIALIST",
                skills: ["Inventory Management Software (e.g., SAP, Oracle)", "Material Handling & Shipping", "Warehouse Optimization", "Budget Planning & Cost Control"]
            }
        };

        function handleMosTranslation() {
            const mosInput = document.getElementById('mos-input-code');
            const branchSelect = document.getElementById('branch-select');
            const resultDiv = document.getElementById('translation-result');
            const titleOutput = document.getElementById('job-title-output');
            const skillsOutput = document.getElementById('skills-output');
            const loadingSpinner = document.getElementById('mos-loading-spinner');
            const translateBtn = document.getElementById('mos-translate-btn');

            const mosTerm = mosInput.value.toUpperCase().trim();
            const branch = branchSelect.value.toUpperCase();
            
            // Key for lookup
            const lookupKey = `${branch}:${mosTerm}`;
            
            if (mosTerm.length < 2) {
                showMessage("Please enter a valid code or job title.", true);
                return;
            }

            // Disable button and show loading spinner
            translateBtn.disabled = true;
            resultDiv.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');

            // Simulate an API call delay
            setTimeout(() => {
                let translation = mockTranslations[lookupKey];

                if (translation) {
                    // SUCCESS: Display the result
                    titleOutput.textContent = `CIVILIAN ROLE: ${translation.title}`;
                    
                    let skillsList = '';
                    translation.skills.forEach(skill => { 
                        skillsList += `<p class="text-sm font-semibold flex items-center accent-green"><span class="accent-orange mr-2 text-xl">‚Ä¢</span>${skill}</p>`;
                    });
                    
                    skillsOutput.innerHTML = `<h4 class="font-bold mt-2 accent-green">CORE SKILLS TRANSLATED:</h4><div class="space-y-1">${skillsList}</div>`;
                    
                    resultDiv.classList.remove('hidden');
                    // Ensure the error color is removed if it was previously set
                    resultDiv.classList.remove('border-red-500'); 
                    resultDiv.classList.add('border-orange-500');
                    
                    showMessage(`Translation executed successfully for "${mosTerm}".`, false);

                } else {
                    // FAILURE: Display Not Found message
                    titleOutput.textContent = ":: DIRECT TRANSLATION FAILED ::";
                    skillsOutput.innerHTML = `<p class="text-sm text-gray-400">We couldn't find a direct match for the code **${mosTerm}** in the **${branch}** database. Try selecting 'General Title/Rank' or a common duty area like 'LOGISTICS'.</p>`;
                    
                    resultDiv.classList.remove('hidden');
                    // Use a warning/error color for failure
                    resultDiv.classList.add('border-red-500');
                    resultDiv.classList.remove('border-orange-500');

                    showMessage("TRANSLATION FAIL. CODE NOT FOUND.", true);
                }

                // Hide spinner and re-enable button
                loadingSpinner.classList.add('hidden');
                translateBtn.disabled = false;

            }, 750); // Delay for visual effect
        }

        // --- PDF GENERATION FUNCTION (Kept from original) ---
        function generateResumePdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'letter'); // Set to Letter size and points unit

            const name = document.getElementById('resume-name').value || "U.S. VETERAN NAME";
            const mos = document.getElementById('resume-mos').value.toUpperCase() || "MILITARY OCCUPATIONAL SPECIALTY";
            const summary = document.getElementById('resume-summary').value;
            const experience = document.getElementById('resume-experience').value;
            const education = document.getElementById('resume-education').value;
            const skills = document.getElementById('resume-skills').value;
            const email = document.getElementById('resume-email').value || "Email Address";
            const phone = document.getElementById('resume-phone').value || "Phone Number";

            // Header
            doc.setFont("Helvetica", "bold");
            doc.setFontSize(24);
            doc.setTextColor(30);
            doc.text(name.toUpperCase(), 40, 70);
            
            doc.setFont("Helvetica", "normal");
            doc.setFontSize(12);
            doc.setTextColor(80);
            doc.text(`Primary Speciality: ${mos}`, 40, 85);
            
            // Contact Info
            doc.setFontSize(10);
            doc.text(`${email} | ${phone} | Location (Optional)`, 40, 100);

            function section(title, y) {
                doc.setFont("Helvetica", "bold");
                doc.setFontSize(14);
                doc.setTextColor(30);
                doc.text(title.toUpperCase(), 40, y);
                doc.setDrawColor(60);
                doc.setLineWidth(0.5); // Use a smaller line width for better look
                doc.line(40, y + 5, 570, y + 5);
                return y + 20; // Reduced vertical space
            }

            let y = section("Professional Summary", 130);
            doc.setFont("Helvetica", "normal");
            doc.setFontSize(11);
            doc.setTextColor(50);
            y = y + doc.splitTextToSize(
                summary || "Dedicated U.S. Military Veteran transitioning into civilian workforce. Highly skilled in leadership, complex logistics, and advanced troubleshooting.",
                520 // Max width
            ).length * 15; // Estimate text height
            doc.text(
                summary || "Dedicated U.S. Military Veteran transitioning into civilian workforce. Highly skilled in leadership, complex logistics, and advanced troubleshooting.",
                40, y - doc.splitTextToSize(summary || "...", 520).length * 15 + 10, { maxWidth: 520 }
            );


            y = section("Experience", y + 40);
            y = y + doc.splitTextToSize(
                experience || "Add work experience here (e.g., 'Led a team of 15 personnel in high-risk logistics operations...' ).",
                520
            ).length * 15;
            doc.text(
                experience || "Add work experience here (e.g., 'Led a team of 15 personnel in high-risk logistics operations...' ).",
                40, y - doc.splitTextToSize(experience || "...", 520).length * 15 + 10, { maxWidth: 520 }
            );

            y = section("Education", y + 40);
            y = y + doc.splitTextToSize(
                education || "Add your education and certifications (e.g., A.A.S. Logistics, Basic Life Support (BLS) Certified).",
                520
            ).length * 15;
            doc.text(
                education || "Add your education and certifications (e.g., A.A.S. Logistics, Basic Life Support (BLS) Certified).",
                40, y - doc.splitTextToSize(education || "...", 520).length * 15 + 10, { maxWidth: 520 }
            );

            y = section("Skills", y + 40);
            const skillList = (skills || "Leadership, Logistics, Training, Troubleshooting")
                .split(",")
                .map(s => s.trim())
                .filter(s => s.length > 0);
            
            let skillY = y;
            skillList.forEach((skill, index) => {
                doc.text(`‚Ä¢ ${skill}`, 40, skillY);
                skillY += 15;
            });
            
            doc.save(`${name.replace(/\s/g, '_')}_Resume_Valor.pdf`);
        }

        // --- STARTUP LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            // Check for a saved tab and switch to it
            const lastTab = localStorage.getItem("sov-last-tab") || 'employment';
            window.switchTab(lastTab);

            // Attach event listeners
            const translateBtn = document.getElementById('mos-translate-btn');
            if (translateBtn) {
                translateBtn.addEventListener('click', handleMosTranslation);
            }

            const downloadResumeBtn = document.getElementById('download-resume-btn');
            if (downloadResumeBtn) {
                downloadResumeBtn.addEventListener('click', generateResumePdf);
            }
        });

        // --- FUNCTIONS FOR FIREBASE (Kept for completeness but not essential for MOS) ---
        // These are placeholders/examples from the original file's logic
        
        function startHistoryListener() { /* ... function body ... */ }
        function updateHistoryUI(historyItems) { /* ... function body ... */ }
        function startGoalListener() { /* ... function body ... */ }
        function renderGoals(goals) { /* ... function body ... */ }
        function startMusterListener() { /* ... function body ... */ }
        function renderMusterFeed(posts) { /* ... function body ... */ }
        function startResourceListener() { /* ... function body ... */ }
        function renderResourceList(resources) { /* ... function body ... */ }
        function performSearch() { /* ... function body ... */ }
        
        window.switchTab = function(tabName) {
            localStorage.setItem("sov-last-tab", tabName);
            const tabs = ['map', 'benefits', 'goals', 'muster', 'employment'];
            tabs.forEach(tab => {
                const content = document.getElementById(`content-${tab}`);
                const button = document.getElementById(`tab-${tab}`);
                if (tab === tabName) {
                    content.classList.remove('hidden');
                    button.classList.add('tab-active');
                    button.classList.remove('tab-inactive');
                } else {
                    content.classList.add('hidden');
                    button.classList.remove('tab-active');
                    button.classList.add('tab-inactive');
                }
            });
        };

        // --- AUTHENTICATION INIT (Kept from original) ---
        async function initializeAuth() {
            try {
                // Check if a custom token exists (e.g., from a server)
                const initialAuthToken = localStorage.getItem('firebaseAuthToken');
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    // Sign in anonymously if no token exists
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Firebase Authentication Error:", error);
                showMessage("AUTH ERROR: Could not establish secure link.", true);
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                isAuthReady = true;
                authStatusEl.innerHTML = `:: SECURE LINK ESTABLISHED - UNIT ID: <span class="accent-orange">${userId.substring(0, 8)}...</span> ::`;
                // Re-enable buttons if Firebase features are ready
                findLocationBtn.disabled = false;
                addGoalBtn.disabled = false;
                postMessageBtn.disabled = false;
                viewHistoryBtn.disabled = false;

                // Start listeners (if their functions are defined)
                if (typeof startHistoryListener === 'function') startHistoryListener();
                if (typeof startGoalListener === 'function') startGoalListener();
                if (typeof startMusterListener === 'function') startMusterListener();
                if (typeof startResourceListener === 'function') startResourceListener();
            } else {
                userId = null;
                isAuthReady = false;
                authStatusEl.innerHTML = ":: LINK FAILURE. Attempting reconnection. ::";
                // Disable buttons if authentication fails
                findLocationBtn.disabled = true;
                addGoalBtn.disabled = true;
                postMessageBtn.disabled = true;
                viewHistoryBtn.disabled = true;
            }
        });

        // Start the authentication process
        initializeAuth();
    </script>
</body>
</html>
